



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Alias Engine Hooks &mdash; tk-alias v2.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Alias Python API" href="alias_python_api.html" />
    <link rel="prev" title="ShotGrid Menu in Alias" href="menu.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
    <a href='http://developer.shotgridsoftware.com'>
    
        <img style='width: 191px;
                height: 60px;
                margin: 2px;
                border-radius: 0px;
                padding: 0px;'
            src='_static/logo@2x.png'/>
    
    </a>
    

          
            <a href="index.html" class="icon icon-home"> tk-alias
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="engine.html">The Alias Engine Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_validator.html">Data Validator</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_watcher.html">Event Watcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="menu.html">ShotGrid Menu in Alias</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Alias Engine Hooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tk-multi-data-validation">tk-multi-data-validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aliasdatavalidationhook">AliasDataValidationHook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tk-multi-loader2">tk-multi-loader2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aliasactions">AliasActions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tk-multi-publish2">tk-multi-publish2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#publishannotationsplugin">PublishAnnotationsPlugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aliassessionpublishplugin">AliasSessionPublishPlugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aliastranslationpublishplugin">AliasTranslationPublishPlugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aliaspublishvariantsplugin">AliasPublishVariantsPlugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aliasstartversioncontrolplugin">AliasStartVersionControlPlugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uploadversionplugin">UploadVersionPlugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tk-multi-shotgunpanel">tk-multi-shotgunpanel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hooks-tk-multi-shotgunpanel-scene-actions">AliasActions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tk-multi-workfiles2">tk-multi-workfiles2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sceneoperation">SceneOperation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alias_python_api.html">Alias Python API</a></li>
</ul>

            
          

    <a href='genindex.html'>Alphabetic Index</a>

    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px;
                color: #b3b3b3;
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>
    <style>
        a.custom_post_menu { display: inline;
                             padding: 0px;
                             text-decoration: underline; }
    </style>

    <b>tk-alias</b> v2.2.1.<br>
    
        This documentation is part of the ShotGrid Pipeline Toolkit.
    
    For more information, please visit
    <a class=custom_post_menu href='https://developer.shotgridsoftware.com'>The ShotGrid developer portal.</a>.
    The code associated with this documentation can be found
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/tk-alias'>here</a>.

    </div>
    <style>
        p.privacy_links { margin: 4px 0px;}
    </style>
    <p class="privacy_links"><a data-opt-in-preferences href="javascript:;">Privacy settings</a></p>
    <p class="privacy_links"><a data-wat-linkname="manage-ccpa-settings-footer-link" href="javascript:;">Do not sell my personal information</a></p>
    <p class="privacy_links"><a href="https://www.autodesk.com/company/legal-notices-trademarks/privacy-statement">Privacy/Cookies</a></p>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">tk-alias</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Alias Engine Hooks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="alias-engine-hooks">
<span id="hooks"></span><h1>Alias Engine Hooks<a class="headerlink" href="#alias-engine-hooks" title="Permalink to this headline">¶</a></h1>
<p>The Alias Engine defines hooks to customize the Toolkit Apps that it uses. See below for App specific hook details.</p>
<div class="section" id="tk-multi-data-validation">
<span id="hooks-tk-multi-data-validation"></span><h2>tk-multi-data-validation<a class="headerlink" href="#tk-multi-data-validation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="aliasdatavalidationhook">
<span id="hooks-tk-multi-data-validation-data-validator"></span><h3>AliasDataValidationHook<a class="headerlink" href="#aliasdatavalidationhook" title="Permalink to this headline">¶</a></h3>
<p>This hook will get the validation rule data from the <a class="reference internal" href="data_validator.html#data-validator"><span class="std std-ref">Data Validator</span></a> and pass it to the tk-multi-data-validation App.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2022 Autodesk, Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the ShotGrid Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the ShotGrid Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Autodesk, Inc.</span>

<span class="kn">import</span> <span class="nn">sgtk</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasDataValidationHook</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hook to define Alias data validation functionality.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">AliasDataValidationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom exception class to report Alias Data Validation errors.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">SanitizedResult</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Class to represent a sanitized check result object.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_valid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialize the object with the given data.</span>

<span class="sd">            :param is_valid: The success status that the check function reported. If not provided, the validity will be determined based on if there are any errors.</span>
<span class="sd">            :type is_valid: bool</span>
<span class="sd">            :param errors: The data errors the check function found. This should be a list of Alias objects, but</span>
<span class="sd">                can be a list of object as long as they follow the expected format.</span>
<span class="sd">            :type errors: list</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">is_valid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">errors</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span> <span class="o">=</span> <span class="n">is_valid</span>

            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span><span class="p">(),</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">errors</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_validation_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the validation rule data set to validate an Alias scene.</span>

<span class="sd">        This method will retrieve the default validation rules returned by</span>
<span class="sd">        :meth:`AliasDataValidator.get_validation_data`. To customize the default</span>
<span class="sd">        validation rules, override this hook method to modify the returned data dictionary.</span>

<span class="sd">        The dictionary returned by this function should be formated such that it can be passed</span>
<span class="sd">        to the :class:`~tk-multi-data-validation:api.data.ValidationRule` class constructor to</span>
<span class="sd">        create a new validation rule object.</span>

<span class="sd">        :return: The validation rules data set.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">data_validator</span><span class="o">.</span><span class="n">get_validation_data</span><span class="p">()</span>

        <span class="c1"># -------------------------------------------------------------------------------------------------------</span>
        <span class="c1">#</span>
        <span class="c1"># Example:</span>
        <span class="c1">#   How to add a custom rule to the default list of validation rules (the data above)</span>
        <span class="c1">#</span>
        <span class="c1">#   This example assume that the tk-multi-data-validation App is being used to display the validation</span>
        <span class="c1">#   data, and to perform the validation functionality.</span>
        <span class="c1">#</span>
        <span class="c1"># -------------------------------------------------------------------------------------------------------</span>
        <span class="c1">#</span>
        <span class="c1">#   Step (1) - define the necessary check, fix, and action callbacks that are required by your new rule.</span>
        <span class="c1">#   Step (2) - add your custom rule entry into the validation data dictionary `data`</span>
        <span class="c1">#   Step (3) - add your custom rule id to your tk-multi-data-validation.yml config settings</span>
        <span class="c1">#</span>
        <span class="c1"># -------------------------------------------------------------------------------------------------------</span>
        <span class="c1">#</span>
        <span class="c1"># # Define a global variable to toggle the custom rule valid state, for demonstrations purposes</span>
        <span class="c1"># global custom_rule_is_valid</span>
        <span class="c1"># custom_rule_is_valid = False</span>
        <span class="c1">#</span>
        <span class="c1"># def check_my_custom_rule(fail_fast=False):</span>
        <span class="c1">#     &quot;&quot;&quot;</span>
        <span class="c1">#     This callback method will execute when the &quot;Validate&quot; button is clicked for this</span>
        <span class="c1">#     rule, or validate all is initiated.</span>
        <span class="c1">#</span>
        <span class="c1">#     NOTE that the check function takes one parameter, `fail_fast`, even if it is not</span>
        <span class="c1">#     used, it should still be defined to follow the &quot;check&quot;functions guidelines (see</span>
        <span class="c1">#     AliasDataValidator class for more info).</span>
        <span class="c1">#</span>
        <span class="c1">#     For examples of more advanced check functions, see the AliasDataValidator class</span>
        <span class="c1">#     methods prefixed with `check_`.</span>
        <span class="c1">#     &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#     if fail_fast:</span>
        <span class="c1">#         # In a fail fast context, just return True or False indicating if the rule is valid</span>
        <span class="c1">#         return custom_rule_is_valid</span>
        <span class="c1">#</span>
        <span class="c1">#     if custom_rule_is_valid:</span>
        <span class="c1">#         # Do not report any errors if the rule is valid</span>
        <span class="c1">#         errors = None</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         # The rule is not valid, return the Alias objects that do not pass the check.</span>
        <span class="c1">#         # In this example, we using a namedtuple to return a list of Alias objects, but</span>
        <span class="c1">#         # a list of Alias objects retrieved from the Alias Python API can also be used</span>
        <span class="c1">#         # directly.</span>
        <span class="c1">#         from collections import namedtuple</span>
        <span class="c1">#         AliasObject = namedtuple(&quot;AliasObject&quot;, [&quot;name&quot;, &quot;type&quot;])</span>
        <span class="c1">#         errors = [</span>
        <span class="c1">#             AliasObject(&quot;node#1&quot;, lambda: &quot;AlSurfaceNode()&quot;),</span>
        <span class="c1">#             AliasObject(&quot;node#2&quot;, lambda: &quot;AlSurfaceNode()&quot;),</span>
        <span class="c1">#         ]</span>
        <span class="c1">#</span>
        <span class="c1">#     # If not fail faist, check functions should return the list of error objects</span>
        <span class="c1">#     return errors</span>
        <span class="c1">#</span>
        <span class="c1"># def fix_my_custom_rule(errors=None):</span>
        <span class="c1">#     &quot;&quot;&quot;</span>
        <span class="c1">#     This callback method will execute when the &quot;Fix&quot; button is clicked for this rule,</span>
        <span class="c1">#     or the fix all is initiated.</span>
        <span class="c1">#</span>
        <span class="c1">#     This fix function just sets the global valid state to True so that the next time</span>
        <span class="c1">#     the check function is executed, it will have a valid state of True.</span>
        <span class="c1">#</span>
        <span class="c1">#     NOTE that the fix function takes one parameter, `errors`, this is not used here</span>
        <span class="c1">#     for simplicity, but it should still be defined to follow the &quot;fix&quot; function</span>
        <span class="c1">#     guidelines (see AliasDataValidator class for more info).</span>
        <span class="c1">#</span>
        <span class="c1">#     For examples of more advanced fix functions, see the AliasDataValidator class</span>
        <span class="c1">#     methods prefixed with `fix_`.</span>
        <span class="c1">#     &quot;&quot;&quot;</span>
        <span class="c1">#     global custom_rule_is_valid</span>
        <span class="c1">#     custom_rule_is_valid = True</span>
        <span class="c1">#</span>
        <span class="c1"># def action_callback(errors=None):</span>
        <span class="c1">#     &quot;&quot;&quot;</span>
        <span class="c1">#     This callback method will execute when the action item is clicked for this rule.</span>
        <span class="c1">#</span>
        <span class="c1">#     The action item can be found by right-clicking the rule to see the menu actions,</span>
        <span class="c1">#     or by clicking the &quot;...&quot; on the rule item row. It is the action called</span>
        <span class="c1">#</span>
        <span class="c1">#         &#39;Click me! Revalidate to see what happend &gt;:)&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#     This action function just sets the global valid state to False so that the next time</span>
        <span class="c1">#     the check function is executed, it will have a valid state of False.</span>
        <span class="c1">#</span>
        <span class="c1">#     NOTE that the fix function takes one parameter, `errors`, this is not used here</span>
        <span class="c1">#     for simplicity, but it should still be defined to follow the action function</span>
        <span class="c1">#     guidelines (see AliasDataValidator class for more info).</span>
        <span class="c1">#</span>
        <span class="c1">#     For examples of more advanced fix functions, see the AliasDataValidator class</span>
        <span class="c1">#     methods.</span>
        <span class="c1">#     &quot;&quot;&quot;</span>
        <span class="c1">#     global custom_rule_is_valid</span>
        <span class="c1">#     custom_rule_is_valid = False</span>
        <span class="c1">#</span>
        <span class="c1"># # Step (2)</span>
        <span class="c1"># data[&quot;my_custom_rule&quot;] = {</span>
        <span class="c1">#     &quot;name&quot;: &quot;My Custom Validation Rule&quot;,</span>
        <span class="c1">#     &quot;description&quot;: &quot;&quot;&quot;</span>
        <span class="c1">#         This is an example to demonstrate how to add a custom rule. Try validating it ----------&gt;&lt;br/&gt;</span>
        <span class="c1">#         Right-click and &#39;Show Details&#39; to open the right-hand panel to see more.</span>
        <span class="c1">#     &quot;&quot;&quot;,</span>
        <span class="c1">#     &quot;error_msg&quot;: &quot;An error has been found by this rule. Let&#39;s fix it!&quot;,</span>
        <span class="c1">#     &quot;fix_name&quot;: &quot;Fix it!&quot;,</span>
        <span class="c1">#     &quot;check_func&quot;: check_my_custom_rule,</span>
        <span class="c1">#     &quot;fix_func&quot;: fix_my_custom_rule,</span>
        <span class="c1">#     &quot;actions&quot;: [</span>
        <span class="c1">#         {&quot;name&quot;: &quot;Click me! Revalidate to see what happend &gt;:)&quot;, &quot;callback&quot;: action_callback}</span>
        <span class="c1">#     ]</span>
        <span class="c1"># }</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">sanitize_check_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanitize the value returned by any validate function to conform to the standard format.</span>

<span class="sd">        Convert the incoming list of Alias objects (that are errors) to conform to the standard</span>
<span class="sd">        format that the Data Validation App requires:</span>

<span class="sd">            is_valid:</span>
<span class="sd">                type: bool</span>
<span class="sd">                description: True if the validate function succeed with the current data, else</span>
<span class="sd">                             False.</span>

<span class="sd">            errors:</span>
<span class="sd">                type: list</span>
<span class="sd">                description: The list of error objects (found by the validate function). None</span>
<span class="sd">                             or empty list if the current data is valid.</span>
<span class="sd">                items:</span>
<span class="sd">                    type: dict</span>
<span class="sd">                    key-values:</span>
<span class="sd">                        id:</span>
<span class="sd">                            type: str | int</span>
<span class="sd">                            description: A unique identifier for the error object.</span>
<span class="sd">                            optional: False</span>
<span class="sd">                        name:</span>
<span class="sd">                            type: str</span>
<span class="sd">                            description: The display name for the error object.</span>
<span class="sd">                            optional: False</span>
<span class="sd">                        type:</span>
<span class="sd">                            type: str</span>
<span class="sd">                            description: The display name of the error object type.</span>
<span class="sd">                            optional: True</span>

<span class="sd">        This method will be called by the Data Validation App after any validate function is</span>
<span class="sd">        called, in order to receive the validate result in the required format.</span>

<span class="sd">        :param result: The result returned by a validation rule ``check_func``. This is</span>
<span class="sd">            should be a list of Alias objects or a boolean value indicating the validity of</span>
<span class="sd">            the check.</span>
<span class="sd">        :type result: list</span>

<span class="sd">        :return: The result of a ``check_func`` in the Data Validation standardized format.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SanitizedResult</span><span class="p">(</span><span class="n">is_valid</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SanitizedResult</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">AliasDataValidationError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot sanitize result type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tk-multi-loader2">
<span id="hooks-tk-multi-loader2"></span><h2>tk-multi-loader2<a class="headerlink" href="#tk-multi-loader2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="aliasactions">
<span id="hooks-tk-multi-loader2-scene-actions"></span><h3>AliasActions<a class="headerlink" href="#aliasactions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2015 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Hook that loads defines all the available actions, broken down by publish type.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">sgtk</span>

<span class="kn">import</span> <span class="nn">alias_api</span>


<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasActions</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">generate_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">ui_area</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of action instances for a particular publish.</span>
<span class="sd">        This method is called each time a user clicks a publish somewhere in the UI.</span>
<span class="sd">        The data returned from this hook will be used to populate the actions menu for a publish.</span>

<span class="sd">        The mapping between Publish types and actions are kept in a different place</span>
<span class="sd">        (in the configuration) so at the point when this hook is called, the loader app</span>
<span class="sd">        has already established *which* actions are appropriate for this object.</span>

<span class="sd">        The hook should return at least one action for each item passed in via the</span>
<span class="sd">        actions parameter.</span>

<span class="sd">        This method needs to return detailed data for those actions, in the form of a list</span>
<span class="sd">        of dictionaries, each with name, params, caption and description keys.</span>

<span class="sd">        Because you are operating on a particular publish, you may tailor the output</span>
<span class="sd">        (caption, tooltip etc) to contain custom information suitable for this publish.</span>

<span class="sd">        The ui_area parameter is a string and indicates where the publish is to be shown.</span>
<span class="sd">        - If it will be shown in the main browsing area, &quot;main&quot; is passed.</span>
<span class="sd">        - If it will be shown in the details area, &quot;details&quot; is passed.</span>
<span class="sd">        - If it will be shown in the history area, &quot;history&quot; is passed.</span>

<span class="sd">        Please note that it is perfectly possible to create more than one action &quot;instance&quot; for</span>
<span class="sd">        an action! You can for example do scene introspection - if the action passed in</span>
<span class="sd">        is &quot;character_attachment&quot; you may for example scan the scene, figure out all the nodes</span>
<span class="sd">        where this object can be attached and return a list of action instances:</span>
<span class="sd">        &quot;attach to left hand&quot;, &quot;attach to right hand&quot; etc. In this case, when more than</span>
<span class="sd">        one object is returned for an action, use the params key to pass additional</span>
<span class="sd">        data into the run_action hook.</span>

<span class="sd">        :param sg_publish_data: ShotGrid data dictionary with all the standard publish fields.</span>
<span class="sd">        :param actions: List of action strings which have been defined in the app configuration.</span>
<span class="sd">        :param ui_area: String denoting the UI Area (see above).</span>
<span class="sd">        :returns List of dictionaries, each with keys name, params, caption and description</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Generate actions called for UI element </span><span class="si">%s</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Actions: </span><span class="si">%s</span><span class="s2">. Publish Data: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ui_area</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">action_instances</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will add the item to the universe as a standard reference.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;import&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;import&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Import into Scene&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the item into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;import_as_reference&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;import_as_reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Import as Reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the item as a reference into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;texture_node&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;texture_node&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Canvas&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the item into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;import_subdiv&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;import_subdiv&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Import Subdiv file into Scene&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the subdiv item into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">action_instances</span>

    <span class="k">def</span> <span class="nf">execute_multiple_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the specified action on a list of items.</span>

<span class="sd">        The default implementation dispatches each item from ``actions`` to</span>
<span class="sd">        the ``execute_action`` method.</span>

<span class="sd">        The ``actions`` is a list of dictionaries holding all the actions to execute.</span>
<span class="sd">        Each entry will have the following values:</span>

<span class="sd">            name: Name of the action to execute</span>
<span class="sd">            sg_publish_data: Publish information coming from ShotGrid</span>
<span class="sd">            params: Parameters passed down from the generate_actions hook.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This is the default entry point for the hook. It reuses the ``execute_action``</span>
<span class="sd">            method for backward compatibility with hooks written for the previous</span>
<span class="sd">            version of the loader.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The hook will stop applying the actions on the selection if an error</span>
<span class="sd">            is raised midway through.</span>

<span class="sd">        :param list actions: Action dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">single_action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">single_action</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">sg_publish_data</span> <span class="o">=</span> <span class="n">single_action</span><span class="p">[</span><span class="s2">&quot;sg_publish_data&quot;</span><span class="p">]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">single_action</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_action</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a given action. The data sent to this be method will</span>
<span class="sd">        represent one of the actions enumerated by the generate_actions method.</span>

<span class="sd">        :param name: Action name string representing one of the items returned by generate_actions.</span>
<span class="sd">        :param params: Params data, as specified by generate_actions.</span>
<span class="sd">        :param sg_publish_data: ShotGrid data dictionary with all the standard publish fields.</span>
<span class="sd">        :returns: No return value expected.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Execute action called for action </span><span class="si">%s</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Parameters: </span><span class="si">%s</span><span class="s2">. Publish Data: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># resolve path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">sg_publish_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;reference&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_reference</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;import&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;import_as_reference&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_file_as_reference</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;texture_node&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_texture_node</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;import_subdiv&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_subdivision</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an Alias reference.</span>

<span class="sd">        :param path: Path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_reference</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import the file into the current Alias session.</span>

<span class="sd">        :param path: Path to file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">alias_api</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import_file_as_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">sg_publish_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import the file as an Alias reference, converting it on the fly as wref.</span>

<span class="sd">        :param path:            Path to the file.</span>
<span class="sd">        :param sg_publish_data: ShotGrid data dictionary with all the standard publish fields</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the tank of the project the file we&#39;re trying to import belongs to</span>
        <span class="c1"># this will be useful to manipulate configuration settings and templates</span>
        <span class="n">tk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_tk_from_project</span><span class="p">(</span><span class="n">sg_publish_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">])</span>

        <span class="c1"># then, get the reference template and the source template to be able to extract fields and build the path to</span>
        <span class="c1"># the translated file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reference_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_reference_template</span><span class="p">(</span>
                <span class="n">tk</span><span class="p">,</span> <span class="n">sg_publish_data</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;There is an issue with Pipeline Configurations for the Linked Project&lt;br&gt;&quot;</span>
                <span class="s2">&quot; Please see the guidelines &lt;a href=https://github.com/shotgunsoftware/tk-alias/wiki/Loading#import-as-reference-from-another-project&gt;&lt;b&gt;here.&lt;/b&gt;&lt;/a&gt;&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">source_template</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">template_from_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># get the path to the reference, using the templates if it&#39;s possible otherwise using the source path</span>
        <span class="c1"># location</span>
        <span class="k">if</span> <span class="n">reference_template</span> <span class="ow">and</span> <span class="n">source_template</span><span class="p">:</span>
            <span class="n">template_fields</span> <span class="o">=</span> <span class="n">source_template</span><span class="o">.</span><span class="n">get_fields</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">template_fields</span><span class="p">[</span><span class="s2">&quot;alias.extension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">reference_path</span> <span class="o">=</span> <span class="n">reference_template</span><span class="o">.</span><span class="n">apply_fields</span><span class="p">(</span><span class="n">template_fields</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_path</span><span class="p">,</span> <span class="n">output_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">reference_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{output_path}</span><span class="s2">_</span><span class="si">{output_ext}</span><span class="s2">.wref&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_ext</span><span class="o">=</span><span class="n">output_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="p">)</span>

        <span class="c1"># if the reference file doesn&#39;t exist on disk yet, run the translation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">reference_path</span><span class="p">):</span>

            <span class="n">framework</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-aliastranslations_v0.x.x&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">framework</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find tk-framework-aliastranslations_v0.x.x&quot;</span><span class="p">)</span>
            <span class="n">tk_framework_aliastranslations</span> <span class="o">=</span> <span class="n">framework</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span>
                <span class="s2">&quot;tk_framework_aliastranslations&quot;</span>
            <span class="p">)</span>

            <span class="n">translator</span> <span class="o">=</span> <span class="n">tk_framework_aliastranslations</span><span class="o">.</span><span class="n">Translator</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">reference_path</span><span class="p">)</span>
            <span class="n">translator</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_reference</span><span class="p">(</span><span class="n">reference_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_texture_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import an image as Canvas in Alias</span>

<span class="sd">        :param path:  Path to the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_texture_node</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import_subdivision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import a file as subdivision in the current Alias session.</span>

<span class="sd">        :param path: Path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">alias_api</span><span class="o">.</span><span class="n">import_subdiv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">AliasPythonException</span> <span class="k">as</span> <span class="n">api_error</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{api_error}</span><span class="s2">&lt;br/&gt;&lt;br/&gt;For more information, click </span><span class="si">{help_link}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">api_error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">api_error</span><span class="p">),</span>
                <span class="n">help_link</span><span class="o">=</span><span class="s2">&quot;&lt;a href=&#39;https://help.autodesk.com/view/ALIAS/2023/ENU/?guid=GUID-667410AD-CF4D-43B3-AE96-0C1331CB80B2&#39;&gt;here&lt;/a&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">AliasPythonException</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tk-multi-publish2">
<span id="hooks-tk-multi-publish2"></span><h2>tk-multi-publish2<a class="headerlink" href="#tk-multi-publish2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="publishannotationsplugin">
<span id="hooks-tk-multi-publish2-publish-annotations"></span><h3>PublishAnnotationsPlugin<a class="headerlink" href="#publishannotationsplugin" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">import</span> <span class="nn">alias_api</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PublishAnnotationsPlugin</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plugin for publishing annotations of the current alias open session</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One line display name describing the plugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Publish Annotations to ShotGrid&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;p&gt;</span>
<span class="s2">            This plugin exports all annotations created using the Locator Annotation tool in Alias.</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;</span>
<span class="s2">            Each annotation will create a Note in ShotGrid. All Notes are linked to this version and file. Use this to</span>
<span class="s2">            sync all review notes made in Alias with ShotGrid.</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of item types that this plugin is interested in.</span>

<span class="sd">        Only items matching entries in this list will be presented to the</span>
<span class="sd">        accept() method. Strings can contain glob patters such as *, for example</span>
<span class="sd">        [&quot;maya.*&quot;, &quot;file.maya&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;alias.session&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called by the publisher to determine if an item is of any</span>
<span class="sd">        interest to this plugin. Only items matching the filters defined via the</span>
<span class="sd">        item_filters property will be presented to this method.</span>

<span class="sd">        A publish task will be generated for each item accepted here. Returns a</span>
<span class="sd">        dictionary with the following booleans:</span>

<span class="sd">            - accepted: Indicates if the plugin is interested in this value at</span>
<span class="sd">                all. Required.</span>
<span class="sd">            - enabled: If True, the plugin will be enabled in the UI, otherwise</span>
<span class="sd">                it will be disabled. Optional, True by default.</span>
<span class="sd">            - visible: If True, the plugin will be visible in the UI, otherwise</span>
<span class="sd">                it will be hidden. Optional, True by default.</span>
<span class="sd">            - checked: If True, the plugin will be checked in the UI, otherwise</span>
<span class="sd">                it will be unchecked. Optional, True by default.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: dictionary with boolean keys accepted, required and enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">has_annotation_locator</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There are not annotations to export&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the given item to check that it is ok to publish. Returns a</span>
<span class="sd">        boolean to indicate validity.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        :returns: True if item is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the publish logic for the given item and settings.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Publishing annotations&quot;</span><span class="p">)</span>

            <span class="c1"># Links, the note will be attached to published file by default</span>
            <span class="c1"># if a version is created the note will be attached to this too</span>
            <span class="n">publish_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_publish_data&quot;</span><span class="p">]</span>
            <span class="n">version_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">)</span>

            <span class="n">note_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">publish_data</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">version_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">note_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version_data</span><span class="p">)</span>

            <span class="n">annotations</span> <span class="o">=</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_annotation_locator_strings</span><span class="p">()</span>

            <span class="n">batch_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
                <span class="n">note_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                    <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;Alias Annotation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">annotation</span><span class="p">,</span>
                    <span class="s2">&quot;note_links&quot;</span><span class="p">:</span> <span class="n">note_links</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">task</span><span class="p">:</span>
                    <span class="n">note_data</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>
                <span class="n">batch_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;request_type&quot;</span><span class="p">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Note&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">note_data</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">batch_data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the finalization pass. This pass executes once all the publish</span>
<span class="sd">        tasks have completed, and can for example be used to version up files.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Annotations published successfully&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="aliassessionpublishplugin">
<span id="hooks-tk-multi-publish2-publish-session"></span><h3>AliasSessionPublishPlugin<a class="headerlink" href="#aliassessionpublishplugin" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">import</span> <span class="nn">alias_api</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasSessionPublishPlugin</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plugin for publishing an open alias session.</span>

<span class="sd">    This hook relies on functionality found in the base file publisher hook in</span>
<span class="sd">    the publish2 app and should inherit from it in the configuration. The hook</span>
<span class="sd">    setting for this plugin should look something like this::</span>

<span class="sd">        hook: &quot;{self}/publish_file.py:{engine}/tk-multi-publish2/basic/publish_session.py&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: The plugin icon and name are defined by the base file plugin.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verbose, multi-line description of what the plugin does. This can</span>
<span class="sd">        contain simple html for formatting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loader_url</span> <span class="o">=</span> <span class="s2">&quot;https://developer.shotgridsoftware.com/a4c0a4f1/?title=Loader&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Publishes the file to ShotGrid. A &lt;b&gt;Publish&lt;/b&gt; entry will be</span>
<span class="s2">        created in ShotGrid which will include a reference to the file&#39;s current</span>
<span class="s2">        path on disk. If a publish template is configured, a copy of the</span>
<span class="s2">        current session will be copied to the publish template path which</span>
<span class="s2">        will be the file that is published. Other users will be able to access</span>
<span class="s2">        the published file via the &lt;b&gt;&lt;a href=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;Loader&lt;/a&gt;&lt;/b&gt; so long as</span>
<span class="s2">        they have access to the file&#39;s location on disk.</span>

<span class="s2">        If the session has not been saved, validation will fail and a button</span>
<span class="s2">        will be provided in the logging output to save the file.</span>

<span class="s2">        &lt;h3&gt;File versioning&lt;/h3&gt;</span>
<span class="s2">        If the filename contains a version number, the process will bump the</span>
<span class="s2">        file to the next version after publishing.</span>

<span class="s2">        The &lt;code&gt;version&lt;/code&gt; field of the resulting &lt;b&gt;Publish&lt;/b&gt; in</span>
<span class="s2">        ShotGrid will also reflect the version number identified in the filename.</span>
<span class="s2">        The basic worklfow recognizes the following version formats by default:</span>

<span class="s2">        &lt;ul&gt;</span>
<span class="s2">        &lt;li&gt;&lt;code&gt;filename.v###.ext&lt;/code&gt;&lt;/li&gt;</span>
<span class="s2">        &lt;li&gt;&lt;code&gt;filename_v###.ext&lt;/code&gt;&lt;/li&gt;</span>
<span class="s2">        &lt;li&gt;&lt;code&gt;filename-v###.ext&lt;/code&gt;&lt;/li&gt;</span>
<span class="s2">        &lt;/ul&gt;</span>

<span class="s2">        After publishing, if a version number is detected in the work file, the</span>
<span class="s2">        work file will automatically be saved to the next incremental version</span>
<span class="s2">        number. For example, &lt;code&gt;filename.v001.ext&lt;/code&gt; will be published</span>
<span class="s2">        and copied to &lt;code&gt;filename.v002.ext&lt;/code&gt;</span>

<span class="s2">        If the next incremental version of the file already exists on disk, the</span>
<span class="s2">        validation step will produce a warning, and a button will be provided in</span>
<span class="s2">        the logging output which will allow saving the session to the next</span>
<span class="s2">        available version number prior to publishing.</span>

<span class="s2">        &lt;br&gt;&lt;br&gt;&lt;i&gt;NOTE: any amount of version number padding is supported. for</span>
<span class="s2">        non-template based workflows.&lt;/i&gt;</span>

<span class="s2">        &lt;h3&gt;Overwriting an existing publish&lt;/h3&gt;</span>
<span class="s2">        In non-template workflows, a file can be published multiple times,</span>
<span class="s2">        however only the most recent publish will be available to other users.</span>
<span class="s2">        Warnings will be provided during validation if there are previous</span>
<span class="s2">        publishes.</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">loader_url</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary defining the settings that this plugin expects to receive</span>
<span class="sd">        through the settings parameter in the accept, validate, publish and</span>
<span class="sd">        finalize methods.</span>

<span class="sd">        A dictionary on the following form::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;Settings Name&quot;: {</span>
<span class="sd">                    &quot;type&quot;: &quot;settings_type&quot;,</span>
<span class="sd">                    &quot;default&quot;: &quot;default_value&quot;,</span>
<span class="sd">                    &quot;description&quot;: &quot;One line description of the setting&quot;</span>
<span class="sd">            }</span>

<span class="sd">        The type string should be one of the data types that toolkit accepts as</span>
<span class="sd">        part of its environment configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># inherit the settings from the base publish plugin</span>
        <span class="n">base_settings</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AliasSessionPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">settings</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># settings specific to this class</span>
        <span class="n">alias_publish_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Publish Template&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Template path for published work files. Should&quot;</span>
                <span class="s2">&quot;correspond to a template defined in &quot;</span>
                <span class="s2">&quot;templates.yml.&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># update the base settings</span>
        <span class="n">base_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">alias_publish_settings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">base_settings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of item types that this plugin is interested in.</span>

<span class="sd">        Only items matching entries in this list will be presented to the</span>
<span class="sd">        accept() method. Strings can contain glob patters such as *, for example</span>
<span class="sd">        [&quot;maya.*&quot;, &quot;file.maya&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;alias.session&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called by the publisher to determine if an item is of any</span>
<span class="sd">        interest to this plugin. Only items matching the filters defined via the</span>
<span class="sd">        item_filters property will be presented to this method.</span>

<span class="sd">        A publish task will be generated for each item accepted here. Returns a</span>
<span class="sd">        dictionary with the following booleans:</span>

<span class="sd">            - accepted: Indicates if the plugin is interested in this value at</span>
<span class="sd">                all. Required.</span>
<span class="sd">            - enabled: If True, the plugin will be enabled in the UI, otherwise</span>
<span class="sd">                it will be disabled. Optional, True by default.</span>
<span class="sd">            - visible: If True, the plugin will be visible in the UI, otherwise</span>
<span class="sd">                it will be hidden. Optional, True by default.</span>
<span class="sd">            - checked: If True, the plugin will be checked in the UI, otherwise</span>
<span class="sd">                it will be unchecked. Optional, True by default.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: dictionary with boolean keys accepted, required and enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># if a publish template is configured, disable context change. This</span>
        <span class="c1"># is a temporary measure until the publisher handles context switching</span>
        <span class="c1"># natively.</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Publish Template&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">context_change_allowed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">_session_path</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># the session has not been saved before (no path determined).</span>
            <span class="c1"># provide a save button. the session will need to be saved before</span>
            <span class="c1"># validation will succeed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The Alias session has not been saved.&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Alias &#39;</span><span class="si">%s</span><span class="s2">&#39; plugin accepted the current Alias session.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the given item to check that it is ok to publish. Returns a</span>
<span class="sd">        boolean to indicate validity.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        :returns: True if item is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_session_path</span><span class="p">()</span>

        <span class="c1"># ---- ensure the session has been saved</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># the session still requires saving. provide a save button.</span>
            <span class="c1"># validation fails.</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;The Alias session has not been saved.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="n">error_msg</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># ---- check that references exist, display warning for invalid refs</span>

        <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_references</span><span class="p">():</span>
            <span class="n">ref_path</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">path</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ref_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Reference path does not exist &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ref_path</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># ---- check the session against any attached work template</span>

        <span class="c1"># get the path in a normalized state. no trailing separator,</span>
        <span class="c1"># separators are appropriate for current os, no double separators,</span>
        <span class="c1"># etc.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ShotgunPath</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># if the session item has a known work template, see if the path</span>
        <span class="c1"># matches. if not, warn the user and provide a way to save the file to</span>
        <span class="c1"># a different path</span>
        <span class="n">work_template</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;work_template&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">work_template</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">work_template</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;The current session does not match the configured work file template.&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">error_msg</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;action_button&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save File&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="s2">&quot;Save the current Alias session to a &quot;</span>
                            <span class="s2">&quot;different file name&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Work template configured and matches session file.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No work template configured.&quot;</span><span class="p">)</span>

        <span class="c1"># ---- see if the version can be bumped post-publish</span>

        <span class="c1"># check to see if the next version of the work file already exists on</span>
        <span class="c1"># disk. if so, warn the user and provide the ability to jump to save</span>
        <span class="c1"># to that version now</span>
        <span class="p">(</span><span class="n">next_version_path</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_next_version_info</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_version_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">next_version_path</span><span class="p">):</span>

            <span class="c1"># determine the next available version_number. just keep asking for</span>
            <span class="c1"># the next one until we get one that doesn&#39;t exist.</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">next_version_path</span><span class="p">):</span>
                <span class="p">(</span><span class="n">next_version_path</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_next_version_info</span><span class="p">(</span>
                    <span class="n">next_version_path</span><span class="p">,</span> <span class="n">item</span>
                <span class="p">)</span>

            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;The next version of this file already exists on disk.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="n">error_msg</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;action_button&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save to v</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,),</span>
                        <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="s2">&quot;Save to the next available version number, &quot;</span>
                        <span class="s2">&quot;v</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,),</span>
                        <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">publisher</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">save_file_as</span><span class="p">(</span>
                            <span class="n">next_version_path</span>
                        <span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># ---- populate the necessary properties and call base class validation</span>

        <span class="c1"># populate the publish template on the item if found</span>
        <span class="n">publish_template_setting</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Publish Template&quot;</span><span class="p">)</span>
        <span class="n">publish_template</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_template_by_name</span><span class="p">(</span>
            <span class="n">publish_template_setting</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">publish_template</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;publish_template&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publish_template</span>

        <span class="c1"># set the session path on the item for use by the base plugin validation</span>
        <span class="c1"># step. NOTE: this path could change prior to the publish phase.</span>
        <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>

        <span class="c1"># run the base class validation</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AliasSessionPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the publish logic for the given item and settings.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># get the path in a normalized state. no trailing separator, separators</span>
        <span class="c1"># are appropriate for current os, no double separators, etc.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ShotgunPath</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">_session_path</span><span class="p">())</span>

        <span class="c1"># ensure the session is saved</span>
        <span class="c1"># we need to do this action locally to be sure the background process could access the work file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">save_file</span><span class="p">()</span>
            <span class="c1"># store the current session path in the root item properties</span>
            <span class="c1"># it will be used later in the background process to open the file before running the publishing actions</span>
            <span class="k">if</span> <span class="s2">&quot;session_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;session_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
                <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span>
                    <span class="s2">&quot;session_name&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Alias Session - </span><span class="si">{task_name}</span><span class="s2">, </span><span class="si">{entity_type}</span><span class="s2"> </span><span class="si">{entity_name}</span><span class="s2"> - </span><span class="si">{file_name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">task_name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">entity_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="n">entity_name</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
                <span class="p">)</span>

        <span class="c1"># update the item with the saved session path</span>
        <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>

            <span class="c1"># add dependencies for the base class to register when publishing</span>
            <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span>
                <span class="s2">&quot;publish_dependencies&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">_alias_find_additional_session_dependencies</span><span class="p">()</span>

            <span class="c1"># let the base class register the publish</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">AliasSessionPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the finalization pass. This pass executes once all the publish</span>
<span class="sd">        tasks have completed, and can for example be used to version up files.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="c1"># do the base class finalization</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">AliasSessionPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="c1"># bump the session file to the next version</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_next_version</span><span class="p">(</span>
                <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">save_file_as</span>
            <span class="p">)</span>


<span class="k">def</span> <span class="nf">_alias_find_additional_session_dependencies</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find additional dependencies from the session</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">references</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_references</span><span class="p">():</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">references</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">references</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">references</span>


<span class="k">def</span> <span class="nf">_session_path</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the path to the current session</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_current_path</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="aliastranslationpublishplugin">
<span id="hooks-tk-multi-publish2-publish-translation"></span><h3>AliasTranslationPublishPlugin<a class="headerlink" href="#aliastranslationpublishplugin" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">alias_api</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasTranslationPublishPlugin</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plugin for publishing an open alias session.</span>

<span class="sd">    This hook relies on functionality found in the base file publisher hook in</span>
<span class="sd">    the publish2 app and should inherit from it in the configuration. The hook</span>
<span class="sd">    setting for this plugin should look something like this::</span>

<span class="sd">        hook: &quot;{self}/publish_file.py:{engine}/tk-multi-publish2/basic/publish_session.py&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: The plugin icon and name are defined by the base file plugin.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verbose, multi-line description of what the plugin does. This can</span>
<span class="sd">        contain simple html for formatting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loader_url</span> <span class="o">=</span> <span class="s2">&quot;https://developer.shotgridsoftware.com/a4c0a4f1/?title=Loader&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Publishes the file to ShotGrid. A &lt;b&gt;Publish&lt;/b&gt; entry will be</span>
<span class="s2">        created in ShotGrid which will include a reference to the file&#39;s current</span>
<span class="s2">        path on disk. If a publish template is configured, a copy of the</span>
<span class="s2">        current session will be copied to the publish template path which</span>
<span class="s2">        will be the file that is published. Other users will be able to access</span>
<span class="s2">        the published file via the &lt;b&gt;&lt;a href=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;Loader&lt;/a&gt;&lt;/b&gt; so long as</span>
<span class="s2">        they have access to the file&#39;s location on disk.</span>

<span class="s2">        &lt;br&gt;&lt;br&gt;&lt;b color=&#39;red&#39;&gt;NOTE:&lt;/b&gt; it&#39;s not possible to publish a WREF file</span>
<span class="s2">        if you already have WREF files loaded in your current session.</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">loader_url</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary defining the settings that this plugin expects to receive</span>
<span class="sd">        through the settings parameter in the accept, validate, publish and</span>
<span class="sd">        finalize methods.</span>

<span class="sd">        A dictionary on the following form::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;Settings Name&quot;: {</span>
<span class="sd">                    &quot;type&quot;: &quot;settings_type&quot;,</span>
<span class="sd">                    &quot;default&quot;: &quot;default_value&quot;,</span>
<span class="sd">                    &quot;description&quot;: &quot;One line description of the setting&quot;</span>
<span class="sd">            }</span>

<span class="sd">        The type string should be one of the data types that toolkit accepts as</span>
<span class="sd">        part of its environment configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># inherit the settings from the base publish plugin</span>
        <span class="n">base_settings</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AliasTranslationPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">settings</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># settings specific to this class</span>
        <span class="n">alias_publish_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Publish Template&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Template path for published work files. Should&quot;</span>
                <span class="s2">&quot;correspond to a template defined in &quot;</span>
                <span class="s2">&quot;templates.yml.&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># update the base settings</span>
        <span class="n">base_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">alias_publish_settings</span><span class="p">)</span>

        <span class="c1"># translator settings</span>
        <span class="n">translator_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Translator Settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Translator settings used to set values like file release number for CATPArt, among &quot;</span>
                <span class="s2">&quot;others. To see all the available options per format, you can look at the command line &quot;</span>
                <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># update the base settings</span>
        <span class="n">base_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">translator_settings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">base_settings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of item types that this plugin is interested in.</span>

<span class="sd">        Only items matching entries in this list will be presented to the</span>
<span class="sd">        accept() method. Strings can contain glob patters such as *, for example</span>
<span class="sd">        [&quot;maya.*&quot;, &quot;file.maya&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;alias.session.translation&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called by the publisher to determine if an item is of any</span>
<span class="sd">        interest to this plugin. Only items matching the filters defined via the</span>
<span class="sd">        item_filters property will be presented to this method.</span>

<span class="sd">        A publish task will be generated for each item accepted here. Returns a</span>
<span class="sd">        dictionary with the following booleans:</span>

<span class="sd">            - accepted: Indicates if the plugin is interested in this value at</span>
<span class="sd">                all. Required.</span>
<span class="sd">            - enabled: If True, the plugin will be enabled in the UI, otherwise</span>
<span class="sd">                it will be disabled. Optional, True by default.</span>
<span class="sd">            - visible: If True, the plugin will be visible in the UI, otherwise</span>
<span class="sd">                it will be hidden. Optional, True by default.</span>
<span class="sd">            - checked: If True, the plugin will be checked in the UI, otherwise</span>
<span class="sd">                it will be unchecked. Optional, True by default.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: dictionary with boolean keys accepted, required and enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

        <span class="n">publish_template_setting</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Publish Template&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">publish_template_setting</span><span class="p">:</span>

            <span class="c1"># if a publish template is configured, disable context change. This</span>
            <span class="c1"># is a temporary measure until the publisher handles context switching</span>
            <span class="c1"># natively.</span>
            <span class="n">item</span><span class="o">.</span><span class="n">context_change_allowed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># get the publish template definition to determine if we are trying to publish a WREF file.</span>
            <span class="c1"># If so, disable the plugin if some references are loaded in the current session</span>
            <span class="n">publish_template</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_template_by_name</span><span class="p">(</span>
                <span class="n">publish_template_setting</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">publish_template</span> <span class="ow">and</span> <span class="s2">&quot;wref&quot;</span> <span class="ow">in</span> <span class="n">publish_template</span><span class="o">.</span><span class="n">definition</span><span class="p">:</span>
                <span class="n">alias_references</span> <span class="o">=</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_references</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">alias_references</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">_session_path</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># the session has not been saved before (no path determined).</span>
            <span class="c1"># provide a save button. the session will need to be saved before</span>
            <span class="c1"># validation will succeed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The Alias session has not been saved.&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Alias &#39;</span><span class="si">%s</span><span class="s2">&#39; plugin accepted the current Alias session.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the given item to check that it is ok to publish. Returns a</span>
<span class="sd">        boolean to indicate validity.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        :returns: True if item is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">_session_path</span><span class="p">()</span>

        <span class="c1"># ---- ensure the session has been saved</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># the session still requires saving. provide a save button.</span>
            <span class="c1"># validation fails.</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;The Alias session has not been saved.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="n">error_msg</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># ---- check the session against any attached work template</span>

        <span class="c1"># get the path in a normalized state. no trailing separator,</span>
        <span class="c1"># separators are appropriate for current os, no double separators,</span>
        <span class="c1"># etc.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ShotgunPath</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># if the session item has a known work template, see if the path</span>
        <span class="c1"># matches. if not, warn the user and provide a way to save the file to</span>
        <span class="c1"># a different path</span>
        <span class="n">work_template</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;work_template&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">work_template</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">work_template</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;The current session does not match the configured work &quot;</span>
                <span class="s2">&quot;file template.&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;action_button&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Save File&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="s2">&quot;Save the current VRED session to a &quot;</span>
                        <span class="s2">&quot;different file name&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Work template configured and matches session file.&quot;</span><span class="p">)</span>

        <span class="c1"># ---- populate the necessary properties and call base class validation</span>

        <span class="c1"># set the session path on the item for use by the base plugin validation</span>
        <span class="c1"># step. NOTE: this path could change prior to the publish phase.</span>
        <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>

        <span class="c1"># if we don&#39;t have a publish path, we can&#39;t publish</span>
        <span class="n">publish_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">publish_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Couldn&#39;t find a valid publish path for the translation file.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># use the framework to get the Alias translator</span>
        <span class="n">framework</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-aliastranslations_v0.x.x&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">framework</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find the Alias Translations Framework&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">tk_framework_aliastranslations</span> <span class="o">=</span> <span class="n">framework</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span>
            <span class="s2">&quot;tk_framework_aliastranslations&quot;</span>
        <span class="p">)</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">tk_framework_aliastranslations</span><span class="o">.</span><span class="n">Translator</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">publish_path</span><span class="p">)</span>

        <span class="c1"># if we don&#39;t match valid conditions for the translator, exit</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">translator</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Invalid conditions for translator.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># if we don&#39;t have translator settings, we can&#39;t publish</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">translator</span><span class="o">.</span><span class="n">translation_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find the translation type.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">translator</span><span class="o">.</span><span class="n">translator_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find translator path.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># store the licensing information in the item properties so that the translation could be run in</span>
        <span class="c1"># background mode</span>
        <span class="n">alias_info</span> <span class="o">=</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_product_information</span><span class="p">()</span>
        <span class="n">item</span><span class="o">.</span><span class="n">local_properties</span><span class="o">.</span><span class="n">license_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;product_key&quot;</span><span class="p">:</span> <span class="n">alias_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product_key&quot;</span><span class="p">),</span>
            <span class="s2">&quot;product_version&quot;</span><span class="p">:</span> <span class="n">alias_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product_version&quot;</span><span class="p">),</span>
            <span class="s2">&quot;product_license_type&quot;</span><span class="p">:</span> <span class="n">alias_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product_license_type&quot;</span><span class="p">),</span>
            <span class="s2">&quot;product_license_path&quot;</span><span class="p">:</span> <span class="n">alias_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;product_license_path&quot;</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AliasTranslationPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the publish logic for the given item and settings.</span>
<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>

            <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

            <span class="c1"># get the path to create and publish</span>
            <span class="n">publish_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="c1"># ensure the publish folder exists:</span>
            <span class="n">publish_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">publish_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">ensure_folder_exists</span><span class="p">(</span><span class="n">publish_folder</span><span class="p">)</span>

            <span class="c1"># need to build a new instance of the translator for each translation because the type is changing</span>
            <span class="n">framework</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-aliastranslations_v0.x.x&quot;</span><span class="p">)</span>
            <span class="n">tk_framework_aliastranslations</span> <span class="o">=</span> <span class="n">framework</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span>
                <span class="s2">&quot;tk_framework_aliastranslations&quot;</span>
            <span class="p">)</span>
            <span class="n">translator</span> <span class="o">=</span> <span class="n">tk_framework_aliastranslations</span><span class="o">.</span><span class="n">Translator</span><span class="p">(</span>
                <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">publish_path</span>
            <span class="p">)</span>

            <span class="c1"># set the license information</span>
            <span class="n">translator</span><span class="o">.</span><span class="n">translator_settings</span><span class="o">.</span><span class="n">license_settings</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span>
                <span class="s2">&quot;license_settings&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Translator Settings&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Translator Settings&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Translator Settings&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">translator</span><span class="o">.</span><span class="n">add_extra_param</span><span class="p">(</span>
                        <span class="n">setting</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span> <span class="n">setting</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">translator</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to run translation: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">parent_sg_publish_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sg_publish_data&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">parent_sg_publish_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">parent_sg_publish_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">AliasTranslationPublishPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="c1"># If we have some parent publish data, share the thumbnail between the parent publish and it child</span>
            <span class="k">if</span> <span class="n">parent_sg_publish_data</span><span class="p">:</span>
                <span class="n">request_timeout</span> <span class="o">=</span> <span class="mi">60</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sharing the thumbnail&quot;</span><span class="p">)</span>
                <span class="n">thumbnail_shared</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;=</span> <span class="n">request_timeout</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">publisher</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">share_thumbnail</span><span class="p">(</span>
                            <span class="n">entities</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sg_publish_data&quot;</span><span class="p">)],</span>
                            <span class="n">source_entity</span><span class="o">=</span><span class="n">parent_sg_publish_data</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thumbnail shared successfully&quot;</span><span class="p">)</span>
                        <span class="n">thumbnail_shared</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">thumbnail_shared</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Thumbnail couln&#39;t be shared&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the finalization pass. This pass executes once all the publish</span>
<span class="sd">        tasks have completed, and can for example be used to version up files.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Translation published successfully&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;action_show_in_shotgun&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Show Publish&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="s2">&quot;Reveal the published file in ShotGrid.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;entity&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_publish_data&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_publish_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a publish template for the supplied settings and item.</span>

<span class="sd">        :param settings: This plugin instance&#39;s configured settings</span>
<span class="sd">        :param item: The item to determine the publish template for</span>

<span class="sd">        :return: A template representing the publish path of the item or</span>
<span class="sd">            None if no template could be identified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># here we can&#39;t use the item.properties.publish_path value as it can store the current session publish template</span>
        <span class="n">publish_template_setting</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Publish Template&quot;</span><span class="p">)</span>
        <span class="n">publish_template</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_template_by_name</span><span class="p">(</span>
            <span class="n">publish_template_setting</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">publish_template</span>

    <span class="k">def</span> <span class="nf">get_publish_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a publish type for the supplied settings and item.</span>

<span class="sd">        :param settings: This plugin instance&#39;s configured settings</span>
<span class="sd">        :param item: The item to determine the publish type for</span>

<span class="sd">        :return: A publish type or None if one could not be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># get the publish type from the publish path extension as the item will have the session publish type</span>
        <span class="n">publish_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="n">path_info</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_file_path_components</span><span class="p">(</span><span class="n">publish_path</span><span class="p">)</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">path_info</span><span class="p">[</span><span class="s2">&quot;extension&quot;</span><span class="p">]</span>

        <span class="c1"># ensure lowercase and no dot</span>
        <span class="k">if</span> <span class="n">extension</span><span class="p">:</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">type_def</span> <span class="ow">in</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;File Types&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>

                <span class="n">publish_type</span> <span class="o">=</span> <span class="n">type_def</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">file_extensions</span> <span class="o">=</span> <span class="n">type_def</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                <span class="k">if</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">file_extensions</span><span class="p">:</span>
                    <span class="c1"># found a matching type in settings. use it!</span>
                    <span class="k">return</span> <span class="n">publish_type</span>

        <span class="c1"># --- no pre-defined publish type found...</span>

        <span class="k">if</span> <span class="n">extension</span><span class="p">:</span>
            <span class="c1"># publish type is based on extension</span>
            <span class="n">publish_type</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> File&quot;</span> <span class="o">%</span> <span class="n">extension</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no extension, assume it is a folder</span>
            <span class="n">publish_type</span> <span class="o">=</span> <span class="s2">&quot;Folder&quot;</span>

        <span class="k">return</span> <span class="n">publish_type</span>

    <span class="k">def</span> <span class="nf">get_publish_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the publish name for the supplied settings and item.</span>

<span class="sd">        :param settings: This plugin instance&#39;s configured settings</span>
<span class="sd">        :param item: The item to determine the publish name for</span>

<span class="sd">        Uses the path info hook to retrieve the publish name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">publish_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">publisher</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_publish_name</span><span class="p">(</span><span class="n">publish_path</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_work_to_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method handles copying work file path(s) to a designated publish</span>
<span class="sd">        location.</span>

<span class="sd">        This method requires a &quot;work_template&quot; and a &quot;publish_template&quot; be set</span>
<span class="sd">        on the supplied item.</span>

<span class="sd">        The method will handle copying the &quot;path&quot; property to the corresponding</span>
<span class="sd">        publish location assuming the path corresponds to the &quot;work_template&quot;</span>
<span class="sd">        and the fields extracted from the &quot;work_template&quot; are sufficient to</span>
<span class="sd">        satisfy the &quot;publish_template&quot;.</span>

<span class="sd">        The method will not attempt to copy files if any of the above</span>
<span class="sd">        requirements are not met. If the requirements are met, the file will</span>
<span class="sd">        ensure the publish path folder exists and then copy the file to that</span>
<span class="sd">        location.</span>

<span class="sd">        If the item has &quot;sequence_paths&quot; set, it will attempt to copy all paths</span>
<span class="sd">        assuming they meet the required criteria with respect to the templates.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># here, as we inherit from the publish_plugin, we have to remove all the actions done in _copy_work_to_publish</span>
        <span class="c1"># otherwise the translation will be erased by the wire work file</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">_session_path</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the path to the current session</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_current_path</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="aliaspublishvariantsplugin">
<span id="hooks-tk-multi-publish2-publish-variants"></span><h3>AliasPublishVariantsPlugin<a class="headerlink" href="#aliaspublishvariantsplugin" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">import</span> <span class="nn">alias_api</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasPublishVariantsPlugin</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plugin for publishing variants of the current alias open session</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One line display name describing the plugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Publish Variants to ShotGrid&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;p&gt;</span>
<span class="s2">            This plugin exports all Variant images created in Alias and makes a Note in ShotGrid for each one.</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;</span>
<span class="s2">            All Notes are linked this version &amp; file. Use this to sync all review notes made in Alias with ShotGrid.</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;</span>
<span class="s2">            To see the Variant images that will be exported, check the Alias Variant Lister.</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of item types that this plugin is interested in.</span>

<span class="sd">        Only items matching entries in this list will be presented to the</span>
<span class="sd">        accept() method. Strings can contain glob patters such as *, for example</span>
<span class="sd">        [&quot;maya.*&quot;, &quot;file.maya&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;alias.session&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called by the publisher to determine if an item is of any</span>
<span class="sd">        interest to this plugin. Only items matching the filters defined via the</span>
<span class="sd">        item_filters property will be presented to this method.</span>

<span class="sd">        A publish task will be generated for each item accepted here. Returns a</span>
<span class="sd">        dictionary with the following booleans:</span>

<span class="sd">            - accepted: Indicates if the plugin is interested in this value at</span>
<span class="sd">                all. Required.</span>
<span class="sd">            - enabled: If True, the plugin will be enabled in the UI, otherwise</span>
<span class="sd">                it will be disabled. Optional, True by default.</span>
<span class="sd">            - visible: If True, the plugin will be visible in the UI, otherwise</span>
<span class="sd">                it will be hidden. Optional, True by default.</span>
<span class="sd">            - checked: If True, the plugin will be checked in the UI, otherwise</span>
<span class="sd">                it will be unchecked. Optional, True by default.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: dictionary with boolean keys accepted, required and enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">has_variants</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There are not variants to export&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the given item to check that it is ok to publish. Returns a</span>
<span class="sd">        boolean to indicate validity.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        :returns: True if item is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the publish logic for the given item and settings.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># as the alias_api.get_variants() method doesn&#39;t work with OpenModel</span>
        <span class="c1"># we need to get the variants locally</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="n">variants</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_variants</span><span class="p">():</span>
                <span class="n">variants</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">variant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">variant</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;alias_variants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variants</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>

            <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">version_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">)</span>
            <span class="n">publish_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_publish_data&quot;</span><span class="p">]</span>

            <span class="c1"># Links, the note will be attached to published file by default</span>
            <span class="c1"># if a version is created the note will be attached to this too</span>
            <span class="n">note_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">publish_data</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">version_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">note_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version_data</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;alias_variants&quot;</span><span class="p">]:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
                    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                    <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;Alias Variant&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">variant</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;note_links&quot;</span><span class="p">:</span> <span class="n">note_links</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">task</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">task</span><span class="p">]</span>

                <span class="n">note</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Note&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">publisher</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Note&quot;</span><span class="p">,</span> <span class="n">entity_id</span><span class="o">=</span><span class="n">note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">path</span><span class="o">=</span><span class="n">variant</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">variant_filepath</span> <span class="o">=</span> <span class="n">variant</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">variant_filepath</span><span class="p">)</span>

                <span class="n">publisher</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Note&quot;</span><span class="p">,</span>
                    <span class="n">entity_id</span><span class="o">=</span><span class="n">note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">variant_filepath</span><span class="p">,</span>
                    <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;attachments&quot;</span><span class="p">,</span>
                    <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{name}{ext}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">variant</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="n">file_ext</span><span class="p">),</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the finalization pass. This pass executes once all the publish</span>
<span class="sd">        tasks have completed, and can for example be used to version up files.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Variants published successfully&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="aliasstartversioncontrolplugin">
<span id="hooks-tk-multi-publish2-start-version-control"></span><h3>AliasStartVersionControlPlugin<a class="headerlink" href="#aliasstartversioncontrolplugin" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sgtk</span>

<span class="kn">import</span> <span class="nn">alias_api</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasStartVersionControlPlugin</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple plugin to insert a version number into the alias file path if one</span>
<span class="sd">    does not exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Path to an png icon on disk</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># look for icon one level up from this hook&#39;s folder in &quot;icons&quot; folder</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_location</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s2">&quot;icons&quot;</span><span class="p">,</span> <span class="s2">&quot;version_up.png&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One line display name describing the plugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Begin file versioning&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verbose, multi-line description of what the plugin does. This can</span>
<span class="sd">        contain simple html for formatting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Adds a version number to the filename.&lt;br&gt;&lt;br&gt;</span>

<span class="s2">        Once a version number exists in the file, the publishing will</span>
<span class="s2">        automatically bump the version number. For example,</span>
<span class="s2">        &lt;code&gt;filename.ext&lt;/code&gt; will be saved to</span>
<span class="s2">        &lt;code&gt;filename.v001.ext&lt;/code&gt;.&lt;br&gt;&lt;br&gt;</span>

<span class="s2">        If the session has not been saved, validation will fail and a button</span>
<span class="s2">        will be provided in the logging output to save the file.&lt;br&gt;&lt;br&gt;</span>

<span class="s2">        If a file already exists on disk with a version number, validation will</span>
<span class="s2">        fail and the logging output will include button to save the file to a</span>
<span class="s2">        different name.&lt;br&gt;&lt;br&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of item types that this plugin is interested in.</span>

<span class="sd">        Only items matching entries in this list will be presented to the</span>
<span class="sd">        accept() method. Strings can contain glob patters such as *, for example</span>
<span class="sd">        [&quot;maya.*&quot;, &quot;file.maya&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;alias.session&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary defining the settings that this plugin expects to receive</span>
<span class="sd">        through the settings parameter in the accept, validate, publish and</span>
<span class="sd">        finalize methods.</span>

<span class="sd">        A dictionary on the following form::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;Settings Name&quot;: {</span>
<span class="sd">                    &quot;type&quot;: &quot;settings_type&quot;,</span>
<span class="sd">                    &quot;default&quot;: &quot;default_value&quot;,</span>
<span class="sd">                    &quot;description&quot;: &quot;One line description of the setting&quot;</span>
<span class="sd">            }</span>

<span class="sd">        The type string should be one of the data types that toolkit accepts as</span>
<span class="sd">        part of its environment configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called by the publisher to determine if an item is of any</span>
<span class="sd">        interest to this plugin. Only items matching the filters defined via the</span>
<span class="sd">        item_filters property will be presented to this method.</span>

<span class="sd">        A publish task will be generated for each item accepted here. Returns a</span>
<span class="sd">        dictionary with the following booleans:</span>

<span class="sd">            - accepted: Indicates if the plugin is interested in this value at</span>
<span class="sd">                all. Required.</span>
<span class="sd">            - enabled: If True, the plugin will be enabled in the UI, otherwise</span>
<span class="sd">                it will be disabled. Optional, True by default.</span>
<span class="sd">            - visible: If True, the plugin will be visible in the UI, otherwise</span>
<span class="sd">                it will be hidden. Optional, True by default.</span>
<span class="sd">            - checked: If True, the plugin will be checked in the UI, otherwise</span>
<span class="sd">                it will be unchecked. Optional, True by default.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: dictionary with boolean keys accepted, required and enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">_session_path</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">version_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_version_number</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Alias &#39;</span><span class="si">%s</span><span class="s2">&#39; plugin rejected the current session...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  There is already a version number in the file...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Alias file path: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,))</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># the session has not been saved before (no path determined).</span>
            <span class="c1"># provide a save button. the session will need to be saved before</span>
            <span class="c1"># validation will succeed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The Alias session has not been saved.&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Alias &#39;</span><span class="si">%s</span><span class="s2">&#39; plugin accepted the current session.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,),</span>
            <span class="n">extra</span><span class="o">=</span><span class="n">_get_version_docs_action</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># accept the plugin, but don&#39;t force the user to add a version number</span>
        <span class="c1"># (leave it unchecked)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the given item to check that it is ok to publish.</span>

<span class="sd">        Returns a boolean to indicate validity.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: True if item is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_session_path</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="c1"># the session still requires saving. provide a save button.</span>
            <span class="c1"># validation fails</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;The Alias session has not been saved.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="n">error_msg</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="c1"># NOTE: If the plugin is attached to an item, that means no version</span>
        <span class="c1"># number could be found in the path. If that&#39;s the case, the work file</span>
        <span class="c1"># template won&#39;t be much use here as it likely has a version number</span>
        <span class="c1"># field defined within it. Simply use the path info hook to inject a</span>
        <span class="c1"># version number into the current file path</span>

        <span class="c1"># get the path to a versioned copy of the file.</span>
        <span class="n">version_path</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_version_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;v001&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">version_path</span><span class="p">):</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;A file already exists with a version number. Please &quot;</span>
                <span class="s2">&quot;choose another name.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="n">error_msg</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_engine</span><span class="p">()</span><span class="o">.</span><span class="n">open_save_as_dialog</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the publish logic for the given item and settings.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

        <span class="c1"># get the path in a normalized state. no trailing separator, separators</span>
        <span class="c1"># are appropriate for current os, no double separators, etc.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ShotgunPath</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">_session_path</span><span class="p">())</span>

        <span class="c1"># ensure the session is saved in its current state</span>
        <span class="n">publisher</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">save_file</span><span class="p">()</span>

        <span class="c1"># get the path to a versioned copy of the file.</span>
        <span class="n">version_path</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_version_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;v001&quot;</span><span class="p">)</span>

        <span class="c1"># save to the new version path</span>
        <span class="n">publisher</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">save_file_as</span><span class="p">(</span><span class="n">version_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;A version number has been added to the Alias file...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Alias file path: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">version_path</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the finalization pass. This pass executes once</span>
<span class="sd">        all the publish tasks have completed, and can for example</span>
<span class="sd">        be used to version up files.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_get_version_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to extract and return a version number for the supplied path.</span>

<span class="sd">        :param path: The path to the current session</span>

<span class="sd">        :return: The version number as an `int` if it can be determined, else</span>
<span class="sd">            None.</span>

<span class="sd">        NOTE: This method will use the work template provided by the</span>
<span class="sd">        session collector, if configured, to determine the version number. If</span>
<span class="sd">        not configured, the version number will be extracted using the zero</span>
<span class="sd">        config path_info hook.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">version_number</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">work_template</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;work_template&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">work_template</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">work_template</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using work template to determine version number.&quot;</span><span class="p">)</span>
                <span class="n">work_fields</span> <span class="o">=</span> <span class="n">work_template</span><span class="o">.</span><span class="n">get_fields</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">work_fields</span><span class="p">:</span>
                    <span class="n">version_number</span> <span class="o">=</span> <span class="n">work_fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Work template did not match path&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Work template unavailable for version extraction.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version_number</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using path info hook to determine version number.&quot;</span><span class="p">)</span>
            <span class="n">version_number</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_version_number</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">version_number</span>


<span class="k">def</span> <span class="nf">_session_path</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the path to the current session</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_current_path</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_version_docs_action</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple helper for returning a log action to show version docs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;action_open_url&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Version Docs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tooltip&quot;</span><span class="p">:</span> <span class="s2">&quot;Show docs for version formats&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://help.autodesk.com/view/SGSUB/ENU/?guid=SG_Supervisor_Artist_sa_integrations_sa_integrations_user_guide_html&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="uploadversionplugin">
<span id="hooks-tk-multi-publish2-upload-version"></span><h3>UploadVersionPlugin<a class="headerlink" href="#uploadversionplugin" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sgtk</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">UploadVersionPlugin</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plugin for sending quicktimes and images to ShotGrid for review.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Translation workers are responsible for performing the LMV translation.</span>
    <span class="c1"># &#39;local&#39;: a local translator will be used, determined based on file type and current engine</span>
    <span class="c1"># &#39;framework&#39;:  the tk-framework-lmv translator will be used (default)</span>
    <span class="n">TRANSLATION_WORKER_LOCAL</span> <span class="o">=</span> <span class="s2">&quot;local&quot;</span>
    <span class="n">TRANSLATION_WORKER_FRAMEWORK</span> <span class="o">=</span> <span class="s2">&quot;framework&quot;</span>
    <span class="n">TRANSLATION_WORKERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">TRANSLATION_WORKER_LOCAL</span><span class="p">,</span> <span class="n">TRANSLATION_WORKER_FRAMEWORK</span><span class="p">]</span>

    <span class="c1"># Version Type string constants</span>
    <span class="n">VERSION_TYPE_2D</span> <span class="o">=</span> <span class="s2">&quot;2D Version&quot;</span>
    <span class="n">VERSION_TYPE_3D</span> <span class="o">=</span> <span class="s2">&quot;3D Version&quot;</span>

    <span class="c1"># Version Type Options</span>
    <span class="n">VERSION_TYPE_OPTIONS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">VERSION_TYPE_2D</span><span class="p">,</span>
        <span class="n">VERSION_TYPE_3D</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Descriptions for Version Types</span>
    <span class="n">VERSION_TYPE_DESCRIPTIONS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">VERSION_TYPE_2D</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                Create a Version in ShotGrid for Review.&lt;br/&gt;&lt;br/&gt;</span>
<span class="s2">                A 2D Version (image or video representation of your file/scene) will be created in ShotGrid.</span>
<span class="s2">                This Version can then be reviewed via ShotGrid&#39;s many review apps.</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="n">VERSION_TYPE_3D</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                Create a Version in ShotGrid for Review.&lt;br/&gt;&lt;br/&gt;</span>
<span class="s2">                A 3D Version (LMV translation of your file/scene&#39;s geometry) will be created in ShotGrid.</span>
<span class="s2">                This Version can then be reviewed via ShotGrid&#39;s many review apps.</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Path to an png icon on disk</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disk_location</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s2">&quot;icons&quot;</span><span class="p">,</span> <span class="s2">&quot;review.png&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary defining the settings that this plugin expects to recieve</span>
<span class="sd">        through the settings parameter in the accept, validate, publish and</span>
<span class="sd">        finalize methods.</span>

<span class="sd">        A dictionary on the following form::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;Settings Name&quot;: {</span>
<span class="sd">                    &quot;type&quot;: &quot;settings_type&quot;,</span>
<span class="sd">                    &quot;default&quot;: &quot;default_value&quot;,</span>
<span class="sd">                    &quot;description&quot;: &quot;One line description of the setting&quot;</span>
<span class="sd">            }</span>

<span class="sd">        The type string should be one of the data types that toolkit accepts as</span>
<span class="sd">        part of its environment configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># inherit the settings from the base publish plugin</span>
        <span class="n">base_settings</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UploadVersionPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">settings</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># settings specific to this class</span>
        <span class="n">upload_version_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Version Type&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_2D</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Generate a </span><span class="si">{options}</span><span class="s2"> or </span><span class="si">{last_option}</span><span class="s2"> Version&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">options</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">last_option</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;Upload&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Upload content to ShotGrid?&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;Translation Worker&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">,</span>
                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSLATION_WORKER_FRAMEWORK</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Specify the worker to use to perform LMV translation.&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># update the base settings</span>
        <span class="n">base_settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">upload_version_settings</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">base_settings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">item_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of item types that this plugin is interested in.</span>

<span class="sd">        Only items matching entries in this list will be presented to the</span>
<span class="sd">        accept() method. Strings can contain glob patters such as *, for example</span>
<span class="sd">        [&quot;maya.*&quot;, &quot;file.maya&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;alias.session&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called by the publisher to determine if an item is of any</span>
<span class="sd">        interest to this plugin. Only items matching the filters defined via the</span>
<span class="sd">        item_filters property will be presented to this method.</span>

<span class="sd">        A publish task will be generated for each item accepted here. Returns a</span>
<span class="sd">        dictionary with the following booleans:</span>

<span class="sd">            - accepted: Indicates if the plugin is interested in this value at</span>
<span class="sd">                all. Required.</span>
<span class="sd">            - enabled: If True, the plugin will be enabled in the UI, otherwise</span>
<span class="sd">                it will be disabled. Optional, True by default.</span>
<span class="sd">            - visible: If True, the plugin will be visible in the UI, otherwise</span>
<span class="sd">                it will be hidden. Optional, True by default.</span>
<span class="sd">            - checked: If True, the plugin will be checked in the UI, otherwise</span>
<span class="sd">                it will be unchecked. Optional, True by default.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>

<span class="sd">        :returns: dictionary with boolean keys accepted, required and enabled</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;accepted&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;checked&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the given item to check that it is ok to publish. Returns a</span>
<span class="sd">        boolean to indicate validity.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        :returns: True if item is valid, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Validate fails if the Version Type is not supported</span>
        <span class="n">version_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Version Type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">version_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unsupported Version Type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_type</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check the site pref for 3D Review enabled. Provide warning messages if the user is</span>
        <span class="c1"># attempting to create a 3D Version but may not have 3D Review enabled on their site, but</span>
        <span class="c1"># do not block the user from publishing.</span>
        <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_3D</span><span class="p">:</span>
            <span class="n">is_3d_viewer_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_3d_viewer_enabled</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">is_3d_viewer_enabled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to check if 3D Review is enabled for your site.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Please contact Autodesk support to access your site preference for 3D Review or use the 2D Version publish option instead.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_3d_viewer_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Your site does not have 3D Review enabled.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Please contact Autodesk support to have 3D Review enabled on your ShotGrid site or use the 2D Version publish option instead.&quot;</span>
                <span class="p">)</span>

        <span class="n">framework_lmv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-lmv_v0.x.x&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">framework_lmv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not run LMV translation: missing ATF framework&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">translation_worker</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Translation Worker&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">translation_worker</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSLATION_WORKERS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Unknown Translation Worker &#39;</span><span class="si">{worker}</span><span class="s2">&#39;. Translation worker must be one of </span><span class="si">{workers}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">worker</span><span class="o">=</span><span class="n">translation_worker</span><span class="p">,</span>
                    <span class="n">workers</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TRANSLATION_WORKERS</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the publish logic for the given item and settings.</span>
<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>

            <span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>

            <span class="c1"># be sure to strip the extension from the publish name</span>
            <span class="n">path_components</span> <span class="o">=</span> <span class="n">publisher</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_file_path_components</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">path_components</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
            <span class="p">(</span><span class="n">publish_name</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;publish_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">publish_name</span>

            <span class="c1"># create the Version in ShotGrid</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">UploadVersionPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="c1"># Get the version type to create</span>
            <span class="n">version_type</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Version Type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

            <span class="c1"># generate the Version content: LMV file (for 3D) or simple 2D thumbnail</span>
            <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_3D</span><span class="p">:</span>
                <span class="n">use_framework_translator</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Translation Worker&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSLATION_WORKER_FRAMEWORK</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating LMV files from source file&quot;</span><span class="p">)</span>
                <span class="c1"># translate the file to lmv and upload the corresponding package to the Version</span>
                <span class="p">(</span>
                    <span class="n">package_path</span><span class="p">,</span>
                    <span class="n">thumbnail_path</span><span class="p">,</span>
                    <span class="n">output_directory</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_file_to_lmv</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">use_framework_translator</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Uploading LMV files to ShotGrid&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                    <span class="n">entity_id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sg_translation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;LMV&quot;</span><span class="p">},</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                    <span class="n">entity_id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">package_path</span><span class="p">,</span>
                    <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;sg_uploaded_movie&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># if the Version thumbnail is empty, update it with the newly created thumbnail</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">get_thumbnail_as_path</span><span class="p">()</span> <span class="ow">and</span> <span class="n">thumbnail_path</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span>
                        <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                        <span class="n">entity_id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="n">path</span><span class="o">=</span><span class="n">thumbnail_path</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1"># delete the temporary folder on disk</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deleting temporary folder&quot;</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">version_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_2D</span><span class="p">:</span>
                <span class="n">thumbnail_path</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_thumbnail_as_path</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using thumbnail image as Version media&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">thumbnail_path</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
                        <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                        <span class="n">entity_id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="n">path</span><span class="o">=</span><span class="n">thumbnail_path</span><span class="p">,</span>
                        <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;sg_uploaded_movie&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">use_framework_translator</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Translation Worker&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRANSLATION_WORKER_FRAMEWORK</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Converting file to LMV to extract thumbnails&quot;</span><span class="p">)</span>
                    <span class="n">output_directory</span><span class="p">,</span> <span class="n">thumbnail_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thumbnail_from_lmv</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">,</span> <span class="n">use_framework_translator</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">thumbnail_path</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Uploading LMV thumbnail file to ShotGrid&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
                            <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                            <span class="n">entity_id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                            <span class="n">path</span><span class="o">=</span><span class="n">thumbnail_path</span><span class="p">,</span>
                            <span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;sg_uploaded_movie&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span>
                            <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                            <span class="n">entity_id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                            <span class="n">path</span><span class="o">=</span><span class="n">thumbnail_path</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Deleting temporary folder&quot;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to generate thumbnail for Version Type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">version_type</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the finalization pass. This pass executes once all the publish</span>
<span class="sd">        tasks have completed, and can for example be used to version up files.</span>

<span class="sd">        :param settings: Dictionary of Settings. The keys are strings, matching</span>
<span class="sd">            the keys returned in the settings property. The values are `Setting`</span>
<span class="sd">            instances.</span>
<span class="sd">        :param item: Item to process</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the publish &quot;mode&quot; stored inside of the root item properties</span>
        <span class="n">bg_processing</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bg_processing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">in_bg_process</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;in_bg_process&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_processing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bg_processing</span> <span class="ow">and</span> <span class="n">in_bg_process</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">UploadVersionPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="c1">############################################################################</span>
    <span class="c1"># Methods for creating/displaying custom plugin interface</span>

    <span class="k">def</span> <span class="nf">create_settings_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Qt widget, for the supplied parent widget (a container widget</span>
<span class="sd">        on the right side of the publish UI).</span>

<span class="sd">        :param parent: The parent to use for the widget being created.</span>
<span class="sd">        :param items: A list of PublishItems the selected publish tasks are parented to.</span>
<span class="sd">        :return: A QtGui.QWidget or subclass that displays information about</span>
<span class="sd">            the plugin and/or editable widgets for modifying the plugin&#39;s</span>
<span class="sd">            settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># defer Qt-related imports</span>
        <span class="kn">from</span> <span class="nn">sgtk.platform.qt</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>

        <span class="c1"># The main widget</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">widget_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>

        <span class="c1"># create a group box to display the description</span>
        <span class="n">description_group_box</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGroupBox</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="n">description_group_box</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Description:&quot;</span><span class="p">)</span>

        <span class="c1"># Defer setting the description text, this will be updated when</span>
        <span class="c1"># the version type combobox value is changed</span>
        <span class="n">description_label</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">()</span>
        <span class="n">description_label</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">description_label</span><span class="o">.</span><span class="n">setOpenExternalLinks</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">description_label</span><span class="o">.</span><span class="n">setTextFormat</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RichText</span><span class="p">)</span>

        <span class="c1"># create the layout to use within the group box</span>
        <span class="n">description_layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">description_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">description_label</span><span class="p">)</span>
        <span class="n">description_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
        <span class="n">description_group_box</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">description_layout</span><span class="p">)</span>

        <span class="c1"># Add a combobox to edit the version type option</span>
        <span class="n">version_type_combobox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">setAccessibleName</span><span class="p">(</span><span class="s2">&quot;Version type selection dropdown&quot;</span><span class="p">)</span>
        <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">)</span>
        <span class="c1"># Hook up the signal/slot to update the description according to the current version type</span>
        <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">index</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_version_type_changed</span><span class="p">(</span>
                <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span> <span class="n">description_label</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Add all the minor widgets to the main widget</span>
        <span class="n">widget_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">description_group_box</span><span class="p">)</span>
        <span class="n">widget_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">version_type_combobox</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">widget_layout</span><span class="p">)</span>

        <span class="c1"># Set the widget property to store the combobox to access in get_ui_settings and set_ui_settings</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;description_label&quot;</span><span class="p">,</span> <span class="n">description_label</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;version_type_combobox&quot;</span><span class="p">,</span> <span class="n">version_type_combobox</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">widget</span>

    <span class="k">def</span> <span class="nf">get_ui_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is required to be defined in order for the custom UI to show up in the app.</span>

<span class="sd">        Invoked by the Publisher when the selection changes. This method gathers the settings</span>
<span class="sd">        on the previously selected task, so that they can be later used to repopulate the</span>
<span class="sd">        custom UI if the task gets selected again. They will also be passed to the accept, validate,</span>
<span class="sd">        publish and finalize methods, so that the settings can be used to drive the publish process.</span>

<span class="sd">        The widget argument is the widget that was previously created by</span>
<span class="sd">        `create_settings_widget`.</span>

<span class="sd">        The method returns a dictionary, where the key is the name of a</span>
<span class="sd">        setting that should be updated and the value is the new value of that</span>
<span class="sd">        setting. Note that it is up to you how you want to store the UI&#39;s state as</span>
<span class="sd">        settings and you don&#39;t have to necessarily to return all the values from</span>
<span class="sd">        the UI. This is to allow the publisher to update a subset of settings</span>
<span class="sd">        when multiple tasks have been selected.</span>

<span class="sd">        Example::</span>

<span class="sd">            {</span>
<span class="sd">                 &quot;setting_a&quot;: &quot;/path/to/a/file&quot;</span>
<span class="sd">            }</span>

<span class="sd">        :param widget: The widget that was created by `create_settings_widget`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ui_settings</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get the Version Type settings value from the UI combobox</span>
        <span class="n">version_type_combobox</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="s2">&quot;version_type_combobox&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version_type_combobox</span><span class="p">:</span>
            <span class="n">version_type_index</span> <span class="o">=</span> <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
            <span class="c1"># if version_type_index &gt;= 0 and version_type_index &lt; len(self.VERSION_TYPE_OPTIONS):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">version_type_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">[</span><span class="n">version_type_index</span><span class="p">]</span>
                <span class="n">ui_settings</span><span class="p">[</span><span class="s2">&quot;Version Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">[</span>
                    <span class="n">version_type_index</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid Version Type index </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_type_index</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">ui_settings</span>

    <span class="k">def</span> <span class="nf">set_ui_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is required to be defined in order for the custom UI to show up in the app.</span>

<span class="sd">        Allows the custom UI to populate its fields with the settings from the</span>
<span class="sd">        currently selected tasks.</span>

<span class="sd">        The widget is the widget created and returned by</span>
<span class="sd">        `create_settings_widget`.</span>

<span class="sd">        A list of settings dictionaries are supplied representing the current</span>
<span class="sd">        values of the settings for selected tasks. The settings dictionaries</span>
<span class="sd">        correspond to the dictionaries returned by the settings property of the</span>
<span class="sd">        hook.</span>

<span class="sd">        Example::</span>

<span class="sd">            settings = [</span>
<span class="sd">            {</span>
<span class="sd">                 &quot;seeting_a&quot;: &quot;/path/to/a/file&quot;</span>
<span class="sd">                 &quot;setting_b&quot;: False</span>
<span class="sd">            },</span>
<span class="sd">            {</span>
<span class="sd">                 &quot;setting_a&quot;: &quot;/path/to/a/file&quot;</span>
<span class="sd">                 &quot;setting_b&quot;: False</span>
<span class="sd">            }]</span>

<span class="sd">        The default values for the settings will be the ones specified in the</span>
<span class="sd">        environment file. Each task has its own copy of the settings.</span>

<span class="sd">        When invoked with multiple settings dictionaries, it is the</span>
<span class="sd">        responsibility of the custom UI to decide how to display the</span>
<span class="sd">        information. If you do not wish to implement the editing of multiple</span>
<span class="sd">        tasks at the same time, you can raise a ``NotImplementedError`` when</span>
<span class="sd">        there is more than one item in the list and the publisher will inform</span>
<span class="sd">        the user than only one task of that type can be edited at a time.</span>

<span class="sd">        :param widget: The widget that was created by `create_settings_widget`.</span>
<span class="sd">        :param settings: a list of dictionaries of settings for each selected</span>
<span class="sd">            task.</span>
<span class="sd">        :param items: A list of PublishItems the selected publish tasks are parented to.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="n">version_type_combobox</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="s2">&quot;version_type_combobox&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_type_combobox</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Failed to retrieve Version Type combobox to set custom UI&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">description_label</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="s2">&quot;description_label&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">description_label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Failed to retrieve Version Type combobox to set custom UI&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get the default setting for version type</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Version Type&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Get the version type value from the settings, and set the combobox accordingly</span>
        <span class="n">version_type_value</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Version Type&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
        <span class="n">version_type_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_OPTIONS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">version_type_value</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Set the version type combobox</span>
        <span class="n">current_version_index</span> <span class="o">=</span> <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_version_index</span> <span class="o">==</span> <span class="n">version_type_index</span><span class="p">:</span>
            <span class="c1"># Combobox already has the correct verstion type - manually trigger the &#39;currentIndexChanged&#39;</span>
            <span class="c1"># slot to update the description label based on the version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_version_type_changed</span><span class="p">(</span><span class="n">version_type_value</span><span class="p">,</span> <span class="n">description_label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version_type_combobox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">version_type_index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_version_type_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version_type</span><span class="p">,</span> <span class="n">description_label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slot called when the Version Type combobox selector index changes.</span>

<span class="sd">        Update the description based on the current Version Type.</span>

<span class="sd">        :param version_type: The current Version Type.</span>
<span class="sd">        :type version_type: str</span>
<span class="sd">        :param description_label: The label widget to set the description on</span>
<span class="sd">        :type description_label: QLabel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">description_label</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_3D</span><span class="p">:</span>
            <span class="n">is_3d_viewer_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_3d_viewer_enabled</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">is_3d_viewer_enabled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    &lt;br/&gt;&lt;br/&gt;</span>
<span class="s2">                    &lt;b&gt;NOTE:&lt;/b&gt;</span>
<span class="s2">                    &lt;br/&gt;</span>
<span class="s2">                    &lt;b&gt;</span>
<span class="s2">                        Failed to check if 3D Review is enabled for your site.</span>
<span class="s2">                    &lt;br/&gt;</span>
<span class="s2">                        You may create a 3D Version for review, but if 3D Review is not enabled,</span>
<span class="s2">                        you will see an error message &#39;No web playable media available&#39; when trying to open the Version with the Media viewer.</span>
<span class="s2">                    &lt;/b&gt;</span>
<span class="s2">                    &lt;br/&gt;&lt;br/&gt;</span>
<span class="s2">                    &lt;b&gt;</span>
<span class="s2">                        Please contact Autodesk support to access your site preference for 3D Review or use the 2D Version publish option instead.</span>
<span class="s2">                    &lt;/b&gt;</span>
<span class="s2">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_3d_viewer_enabled</span><span class="p">:</span>
                <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    &lt;br/&gt;&lt;br/&gt;</span>
<span class="s2">                    &lt;b&gt;NOTE:&lt;/b&gt;</span>
<span class="s2">                    &lt;br/&gt;</span>
<span class="s2">                    &lt;b&gt;</span>
<span class="s2">                       Your site does not have 3D Review enabled.</span>
<span class="s2">                        &lt;br/&gt;</span>
<span class="s2">                       You may create a 3D Version for review, but until your site has 3D Review enabled,</span>
<span class="s2">                       you will see an error message &#39;No web playable media available&#39; when trying to open the Version with the Media viewer.</span>
<span class="s2">                    &lt;/b&gt;</span>
<span class="s2">                    &lt;br/&gt;&lt;br/&gt;</span>
<span class="s2">                    &lt;b&gt;</span>
<span class="s2">                        Please contact Autodesk support to have 3D Review enabled on your ShotGrid site or use the 2D Version publish option instead.</span>
<span class="s2">                    &lt;/b&gt;</span>
<span class="s2">                &quot;&quot;&quot;</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{description}{note}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VERSION_TYPE_DESCRIPTIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">version_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
            <span class="p">),</span>
            <span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">description_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="c1">############################################################################</span>
    <span class="c1"># Protected functions</span>

    <span class="k">def</span> <span class="nf">_translate_file_to_lmv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">use_framework_translator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate the current Alias file as an LMV package in order to upload it to ShotGrid as a 3D Version</span>

<span class="sd">        :param item: Item to process</span>
<span class="sd">        :param use_framework_translator: True will force the translator shipped with tk-framework-lmv to be used</span>
<span class="sd">        :returns:</span>
<span class="sd">            - The path to the LMV zip file</span>
<span class="sd">            - The path to the LMV thumbnail</span>
<span class="sd">            - The path to the temporary folder where the LMV files have been processed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">framework_lmv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-lmv_v0.x.x&quot;</span><span class="p">)</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">framework_lmv</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;translator&quot;</span><span class="p">)</span>

        <span class="c1"># translate the file to lmv</span>
        <span class="n">lmv_translator</span> <span class="o">=</span> <span class="n">translator</span><span class="o">.</span><span class="n">LMVTranslator</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Converting file to LMV&quot;</span><span class="p">)</span>
        <span class="n">lmv_translator</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">use_framework_translator</span><span class="o">=</span><span class="n">use_framework_translator</span><span class="p">)</span>

        <span class="c1"># package it up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Packaging LMV files&quot;</span><span class="p">)</span>
        <span class="n">package_path</span><span class="p">,</span> <span class="n">thumbnail_path</span> <span class="o">=</span> <span class="n">lmv_translator</span><span class="o">.</span><span class="n">package</span><span class="p">(</span>
            <span class="n">svf_file_name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;sg_version_data&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span>
            <span class="n">thumbnail_path</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">get_thumbnail_as_path</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">package_path</span><span class="p">,</span> <span class="n">thumbnail_path</span><span class="p">,</span> <span class="n">lmv_translator</span><span class="o">.</span><span class="n">output_directory</span>

    <span class="k">def</span> <span class="nf">_get_thumbnail_from_lmv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">use_framework_translator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the thumbnail from the source file, using the LMV conversion</span>

<span class="sd">        :param item: Item to process</span>
<span class="sd">        :param use_framework_translator: True will force the translator shipped with tk-framework-lmv to be used</span>
<span class="sd">        :returns:</span>
<span class="sd">            - The path to the temporary folder where the LMV files have been processed</span>
<span class="sd">            - The path to the LMV thumbnail</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">framework_lmv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-lmv_v0.x.x&quot;</span><span class="p">)</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">framework_lmv</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;translator&quot;</span><span class="p">)</span>

        <span class="c1"># translate the file to lmv</span>
        <span class="n">lmv_translator</span> <span class="o">=</span> <span class="n">translator</span><span class="o">.</span><span class="n">LMVTranslator</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Converting file to LMV&quot;</span><span class="p">)</span>
        <span class="n">lmv_translator</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">use_framework_translator</span><span class="o">=</span><span class="n">use_framework_translator</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting thumbnails from LMV&quot;</span><span class="p">)</span>
        <span class="n">thumbnail_path</span> <span class="o">=</span> <span class="n">lmv_translator</span><span class="o">.</span><span class="n">extract_thumbnail</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">thumbnail_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Couldn&#39;t retrieve thumbnail data from LMV. Version won&#39;t have any associated media&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">lmv_translator</span><span class="o">.</span><span class="n">output_directory</span>

        <span class="k">return</span> <span class="n">lmv_translator</span><span class="o">.</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">thumbnail_path</span>

    <span class="k">def</span> <span class="nf">_is_3d_viewer_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look up the ShotGrid site preference to check if the 3D Viewer is enabled. Return True</span>
<span class="sd">        if the 3D Viewer is enabled, False if it is disabled, or None if the 3D Viewer Enabled</span>
<span class="sd">        site pref could not be accessed.</span>

<span class="sd">        If the ShotGrid API returns an empty dictionary, the hidden site preference could not be</span>
<span class="sd">        accessed. Ensure that the hidden site preference &quot;API hidden allowed list of preferences&quot;</span>
<span class="sd">        contains the &quot;enable_3d_viewer&quot; in its list.</span>

<span class="sd">        :return: True if the 3D Viewer is enabled for the ShotGrid site, False if it is disabled,</span>
<span class="sd">                 or None if the 3D Viewer site pref could not be accessed.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">enable_3d_viewer_pref</span> <span class="o">=</span> <span class="s2">&quot;enable_3d_viewer&quot;</span>
        <span class="n">prefs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">shotgun</span><span class="o">.</span><span class="n">preferences_read</span><span class="p">(</span><span class="n">prefs</span><span class="o">=</span><span class="p">[</span><span class="n">enable_3d_viewer_pref</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prefs</span><span class="p">:</span>
            <span class="c1"># The &#39;enable_3d_viewer&#39; site pref could not be accessed</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">prefs</span><span class="p">[</span><span class="n">enable_3d_viewer_pref</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tk-multi-shotgunpanel">
<h2>tk-multi-shotgunpanel<a class="headerlink" href="#tk-multi-shotgunpanel" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hooks-tk-multi-shotgunpanel-scene-actions">
<span id="id1"></span><h3>AliasActions<a class="headerlink" href="#hooks-tk-multi-shotgunpanel-scene-actions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2015 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Hook that loads defines all the available actions, broken down by publish type.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">import</span> <span class="nn">alias_api</span>

<span class="n">HookBaseClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">AliasActions</span><span class="p">(</span><span class="n">HookBaseClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ShotGrid Panel Actions for Alias</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">generate_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">ui_area</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of action instances for a particular publish.</span>
<span class="sd">        This method is called each time a user clicks a publish somewhere in the UI.</span>
<span class="sd">        The data returned from this hook will be used to populate the actions menu for a publish.</span>

<span class="sd">        The mapping between Publish types and actions are kept in a different place</span>
<span class="sd">        (in the configuration) so at the point when this hook is called, the loader app</span>
<span class="sd">        has already established *which* actions are appropriate for this object.</span>

<span class="sd">        The hook should return at least one action for each item passed in via the</span>
<span class="sd">        actions parameter.</span>

<span class="sd">        This method needs to return detailed data for those actions, in the form of a list</span>
<span class="sd">        of dictionaries, each with name, params, caption and description keys.</span>

<span class="sd">        Because you are operating on a particular publish, you may tailor the output</span>
<span class="sd">        (caption, tooltip etc) to contain custom information suitable for this publish.</span>

<span class="sd">        The ui_area parameter is a string and indicates where the publish is to be shown.</span>
<span class="sd">        - If it will be shown in the main browsing area, &quot;main&quot; is passed.</span>
<span class="sd">        - If it will be shown in the details area, &quot;details&quot; is passed.</span>
<span class="sd">        - If it will be shown in the history area, &quot;history&quot; is passed.</span>

<span class="sd">        Please note that it is perfectly possible to create more than one action &quot;instance&quot; for</span>
<span class="sd">        an action! You can for example do scene introspection - if the action passed in</span>
<span class="sd">        is &quot;character_attachment&quot; you may for example scan the scene, figure out all the nodes</span>
<span class="sd">        where this object can be attached and return a list of action instances:</span>
<span class="sd">        &quot;attach to left hand&quot;, &quot;attach to right hand&quot; etc. In this case, when more than</span>
<span class="sd">        one object is returned for an action, use the params key to pass additional</span>
<span class="sd">        data into the run_action hook.</span>

<span class="sd">        :param sg_data: ShotGrid data dictionary with all the standard publish fields.</span>
<span class="sd">        :param actions: List of action strings which have been defined in the app configuration.</span>
<span class="sd">        :param ui_area: String denoting the UI Area (see above).</span>
<span class="sd">        :returns List of dictionaries, each with keys name, params, caption and description</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Generate actions called for UI element </span><span class="si">%s</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Actions: </span><span class="si">%s</span><span class="s2">. Publish Data: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ui_area</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">action_instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># call base class first</span>
            <span class="n">action_instances</span> <span class="o">+=</span> <span class="n">HookBaseClass</span><span class="o">.</span><span class="n">generate_actions</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">ui_area</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># base class doesn&#39;t have the method, so ignore and continue</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="s2">&quot;reference&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will add the item to the universe as a standard reference.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;import&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;import&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Import into Scene&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the item into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;import_as_reference&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;import_as_reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Import as Reference&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the item as a reference into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;texture_node&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;texture_node&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Canvas&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the item into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;import_subdiv&quot;</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">action_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;import_subdiv&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="s2">&quot;Import Subdiv file into Scene&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This will import the subdiv item into the current universe.&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">action_instances</span>

    <span class="k">def</span> <span class="nf">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a given action. The data sent to this be method will</span>
<span class="sd">        represent one of the actions enumerated by the generate_actions method.</span>

<span class="sd">        :param name: Action name string representing one of the items returned by generate_actions.</span>
<span class="sd">        :param params: Params data, as specified by generate_actions.</span>
<span class="sd">        :param sg_data: ShotGrid data dictionary with all the standard publish fields.</span>
<span class="sd">        :returns: No return value expected.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Execute action called for action </span><span class="si">%s</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Parameters: </span><span class="si">%s</span><span class="s2">. ShotGrid Data: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;reference&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">sg_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_reference</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;import&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">sg_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;import_as_reference&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">sg_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_file_as_reference</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;texture_node&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">sg_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_texture_node</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;import_subdiv&quot;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publish_path</span><span class="p">(</span><span class="n">sg_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_subdivision</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">HookBaseClass</span><span class="o">.</span><span class="n">execute_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># base class doesn&#39;t have the method, so ignore and continue</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">execute_multiple_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the specified action on a list of items.</span>

<span class="sd">        The default implementation dispatches each item from ``actions`` to</span>
<span class="sd">        the ``execute_action`` method.</span>

<span class="sd">        The ``actions`` is a list of dictionaries holding all the actions to execute.</span>
<span class="sd">        Each entry will have the following values:</span>

<span class="sd">            name: Name of the action to execute</span>
<span class="sd">            sg_data: Publish information coming from ShotGrid</span>
<span class="sd">            params: Parameters passed down from the generate_actions hook.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This is the default entry point for the hook. It reuses the ``execute_action``</span>
<span class="sd">            method for backward compatibility with hooks written for the previous</span>
<span class="sd">            version of the loader.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The hook will stop applying the actions on the selection if an error</span>
<span class="sd">            is raised midway through.</span>

<span class="sd">        :param list actions: Action dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">single_action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">single_action</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">sg_data</span> <span class="o">=</span> <span class="n">single_action</span><span class="p">[</span><span class="s2">&quot;sg_data&quot;</span><span class="p">]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">single_action</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execute_action</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an Alias reference.</span>

<span class="sd">        :param path: Path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_reference</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import the file into the current Alias session.</span>

<span class="sd">        :param path: Path to file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">alias_api</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import_file_as_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import the file as an Alias reference, converting it on the fly as wref.</span>

<span class="sd">        :param path: Path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">reference_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;reference_template&quot;</span><span class="p">)</span>
        <span class="n">source_template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgtk</span><span class="o">.</span><span class="n">template_from_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># get the path to the reference, using the templates if it&#39;s possible otherwise using the source path</span>
        <span class="c1"># location</span>
        <span class="k">if</span> <span class="n">reference_template</span> <span class="ow">and</span> <span class="n">source_template</span><span class="p">:</span>
            <span class="n">template_fields</span> <span class="o">=</span> <span class="n">source_template</span><span class="o">.</span><span class="n">get_fields</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">template_fields</span><span class="p">[</span><span class="s2">&quot;alias.extension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">reference_path</span> <span class="o">=</span> <span class="n">reference_template</span><span class="o">.</span><span class="n">apply_fields</span><span class="p">(</span><span class="n">template_fields</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_path</span><span class="p">,</span> <span class="n">output_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">reference_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{output_path}</span><span class="s2">_</span><span class="si">{output_ext}</span><span class="s2">.wref&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_ext</span><span class="o">=</span><span class="n">output_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="p">)</span>

        <span class="c1"># if the reference file doesn&#39;t exist on disk yet, run the translation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">reference_path</span><span class="p">):</span>

            <span class="n">framework</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_framework</span><span class="p">(</span><span class="s2">&quot;tk-framework-aliastranslations_v0.x.x&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">framework</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t find tk-framework-aliastranslations_v0.x.x&quot;</span><span class="p">)</span>
            <span class="n">tk_framework_aliastranslations</span> <span class="o">=</span> <span class="n">framework</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span>
                <span class="s2">&quot;tk_framework_aliastranslations&quot;</span>
            <span class="p">)</span>

            <span class="n">translator</span> <span class="o">=</span> <span class="n">tk_framework_aliastranslations</span><span class="o">.</span><span class="n">Translator</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">reference_path</span><span class="p">)</span>
            <span class="n">translator</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_reference</span><span class="p">(</span><span class="n">reference_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_texture_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import an image as Canvas in Alias</span>

<span class="sd">        :param path:  Path to the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_texture_node</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import_subdivision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import a file as subdivision in the current Alias session.</span>

<span class="sd">        :param path: Path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not found on disk - &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">alias_api</span><span class="o">.</span><span class="n">import_subdiv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">AliasPythonException</span> <span class="k">as</span> <span class="n">api_error</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{api_error}</span><span class="s2">&lt;br/&gt;&lt;br/&gt;For more information, click </span><span class="si">{help_link}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">api_error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">api_error</span><span class="p">),</span>
                <span class="n">help_link</span><span class="o">=</span><span class="s2">&quot;&lt;a href=&#39;https://help.autodesk.com/view/ALIAS/2023/ENU/?guid=GUID-667410AD-CF4D-43B3-AE96-0C1331CB80B2&#39;&gt;here&lt;/a&gt;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">AliasPythonException</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tk-multi-workfiles2">
<h2>tk-multi-workfiles2<a class="headerlink" href="#tk-multi-workfiles2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sceneoperation">
<span id="hooks-tk-multi-workfiles2-scene-operations"></span><h3>SceneOperation<a class="headerlink" href="#sceneoperation" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2017 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">alias_api</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">from</span> <span class="nn">sgtk.platform.qt</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="n">HookClass</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">get_hook_baseclass</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SceneOperation</span><span class="p">(</span><span class="n">HookClass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hook called to perform an operation with the</span>
<span class="sd">    current file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">,</span>
        <span class="n">file_path</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_action</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">file_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">read_only</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main hook entry point</span>

<span class="sd">        :param operation:       String</span>
<span class="sd">                                Scene operation to perform</span>

<span class="sd">        :param file_path:       String</span>
<span class="sd">                                File path to use if the operation</span>
<span class="sd">                                requires it (e.g. open)</span>

<span class="sd">        :param context:         Context</span>
<span class="sd">                                The context the file operation is being</span>
<span class="sd">                                performed in.</span>

<span class="sd">        :param parent_action:   This is the action that this scene operation is</span>
<span class="sd">                                being executed for.  This can be one of:</span>
<span class="sd">                                - open_file</span>
<span class="sd">                                - new_file</span>
<span class="sd">                                - save_file_as</span>
<span class="sd">                                - version_up</span>

<span class="sd">        :param file_version:    The version/revision of the file to be opened.  If this is &#39;None&#39;</span>
<span class="sd">                                then the latest version should be opened.</span>

<span class="sd">        :param read_only:       Specifies if the file should be opened read-only or not</span>

<span class="sd">        :returns:               Depends on operation:</span>
<span class="sd">                                &#39;current_path&#39; - Return the current scene</span>
<span class="sd">                                                 file path as a String</span>
<span class="sd">                                &#39;open&#39;         - True if file was opened, otherwise False</span>
<span class="sd">                                &#39;reset&#39;        - True if scene was reset to an empty</span>
<span class="sd">                                                 state, otherwise False</span>
<span class="sd">                                all others     - None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># At the end of the scene operation, indicate if the context needs to be saved for the</span>
        <span class="c1"># current Alias stage.</span>
        <span class="n">save_context</span> <span class="o">=</span> <span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;save_as&quot;</span><span class="p">,</span> <span class="s2">&quot;prepare_new&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;reset&quot;</span><span class="p">]</span>

        <span class="c1"># Use the event watcher context manager to queue any callbacks triggered by Alias</span>
        <span class="c1"># events while performing any scene operations. This ensures that all Alias file I/O</span>
        <span class="c1"># operations are complete before executing any event callbacks that may interfere</span>
        <span class="c1"># with Alias</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">event_watcher</span><span class="o">.</span><span class="n">ContextManager</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;current_path&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">get_current_path</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">is_empty_file</span><span class="p">():</span>
                        <span class="n">alias_api</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_stage</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">open_in_current_stage</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">open_delete_stages_dialog</span><span class="p">()</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">open_in_current_stage</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                            <span class="c1"># Do not save the context if the operation was cancelled.</span>
                            <span class="n">save_context</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">return</span> <span class="kc">False</span>

                        <span class="k">if</span> <span class="n">open_in_current_stage</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                            <span class="n">alias_api</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_stage</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">alias_api</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
                            <span class="n">alias_api</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_stage</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;save&quot;</span><span class="p">:</span>
                    <span class="n">alias_api</span><span class="o">.</span><span class="n">save_file</span><span class="p">()</span>

                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;save_as&quot;</span><span class="p">:</span>
                    <span class="n">alias_api</span><span class="o">.</span><span class="n">save_file_as</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;reset&quot;</span><span class="p">:</span>
                    <span class="c1"># do not reset the file if we try to open another one as we have to deal with the stages an resetting</span>
                    <span class="c1"># the current session will delete all the stages</span>
                    <span class="k">if</span> <span class="n">parent_action</span> <span class="o">==</span> <span class="s2">&quot;open_file&quot;</span><span class="p">:</span>
                        <span class="n">save_context</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">return</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="n">alias_api</span><span class="o">.</span><span class="n">is_empty_file</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">alias_api</span><span class="o">.</span><span class="n">get_stages</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">alias_api</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
                        <span class="k">return</span> <span class="kc">True</span>

                    <span class="n">open_in_current_stage</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">open_delete_stages_dialog</span><span class="p">(</span><span class="n">new_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">open_in_current_stage</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                        <span class="c1"># Do not save the context if the operation was cancelled.</span>
                        <span class="n">save_context</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">return</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="n">open_in_current_stage</span> <span class="o">==</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">:</span>
                        <span class="n">stage_name</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
                        <span class="n">alias_api</span><span class="o">.</span><span class="n">create_stage</span><span class="p">(</span><span class="n">stage_name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">alias_api</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">save_context</span><span class="p">:</span>
                    <span class="c1"># It is important that this method is executed before the event watcher</span>
                    <span class="c1"># context manager exits to ensure that the current context is saved for</span>
                    <span class="c1"># this Alias stage, before any event callbacks are triggered (whcih may</span>
                    <span class="c1"># require the contexts to be updated).</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">save_context_for_stage</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="alias_python_api.html" class="btn btn-neutral float-right" title="Alias Python API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="menu.html" class="btn btn-neutral float-left" title="ShotGrid Menu in Alias" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Autodesk

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 

  <script type="text/javascript">
    window.wafCCPAForceShow = true;
    (function(a,b,c,d){
      a='https://tags.tiqcdn.com/utag/autodesk/micro-basic/prod/utag.js';
      b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
      a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
    })();
  </script>


</body>
</html>